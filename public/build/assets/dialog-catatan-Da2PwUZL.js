import{r as l,u as oe,j as s,b as ie}from"./app-CPskstAv.js";import{a as le,b as ne,c as de,d as ce,e as L}from"./dialog-cC233ulC.js";import{T as M,a as U,b as z,c as $}from"./tooltip-8RJYWOsU.js";import{I as pe}from"./input-CDsb02z_.js";import{B as x}from"./button-DVnw63hJ.js";import{d as ue,b as fe,T as S,c as T,e as me,a as h}from"./table-kKyIuAuy.js";import{C as xe}from"./checkbox-4w9MF4Kd.js";import{S as he}from"./spinner-5Uae_jPp.js";import{t as i}from"./index-LxfgKXR4.js";import{I as je}from"./input-error-10G6LJWt.js";import{c as y}from"./index-CBGkccfa.js";import{A as be,a as ge,b as ke,u as ye}from"./use-initials-Dg7l8F5j.js";import{P as ve,T as Ne}from"./trash-BjkFRwtO.js";/* empty css            */import"./index-D1qKGPHi.js";import"./createLucideIcon-C2iFPrfA.js";import"./index-B17OepHW.js";import"./index-AjYOHAR7.js";import"./Combination-awoxvRvc.js";import"./index-DNPXXR2E.js";import"./index-BvaIFVjI.js";import"./index-CYbzSx9y.js";import"./index-46n4DGVn.js";import"./index-CTsJdAZR.js";import"./index-BZ2HSPaJ.js";import"./check-BwigAa8m.js";import"./loader-circle-BadshYxY.js";import"./index-DE4duBNV.js";function Ve({dialogOpen:B,user:j,updateJumlahCatatan:H,dataValue:b,stateCatatans:p}){const q=ye(),[g,n]=l.useState([]),[K,D]=l.useState(!1),[R,A]=l.useState(!1),v=l.useRef(null),[N,w]=l.useState("create"),[G,C]=l.useState(!1),[d,u]=l.useState([]),I=j.roleuser.slug==="admin"||j.roleuser.slug==="verifikator",{data:c,setData:f,post:Q,put:W,delete:X,processing:E,errors:Y,clearErrors:m}=oe({id:"",berka_id:0,catatan:""}),Z=l.useCallback(async()=>{D(!0);try{const t=await(await fetch(y.index(b).url)).json();n(t),D(!1)}catch(e){throw D(!1),e}},[]),F=e=>{n([...g,{id:e.id,berka_id:e.berka_id,catatan:e.catatan,created_at:e.created_at,foto:e.foto,name:e.name,is_okey:e.is_okey,user_id:e.user_id}]),A(!0)},P=e=>{n(t=>t.map(a=>a.id===e.id?{...a,catatan:e.catatan,created_at:e.created_at}:a))},J=e=>{w("edit"),f({id:e.id,berka_id:e.berka_id,catatan:e.catatan})},O=e=>{n(g.filter(t=>t.id!==e))},V=e=>{e.preventDefault();const t=d;if(d.length>0)ie.post(y.updateChecked(),{berka_id:b.id,items_data:t},{preserveScroll:!0,onSuccess:a=>{if(a.props.flash?.type==="success"){const r=a.props.newdata?.datas;i.success(a.props.flash?.message,{position:"top-center"}),n(r)}else a.props.flash?.type==="error"?i.error(a.props.flash?.message,{position:"top-center"}):i.info(a.props.flash?.message,{position:"top-center"});u([])}});else switch(N){case"edit":W(y.update(c.id).url,{preserveScroll:!0,onSuccess:a=>{a.props.flash?.type==="success"?(P(a.props.newdata?.datas),i.success(a.props.flash?.message,{position:"top-center"})):a.props.flash?.type==="error"?i.error(a.props.flash?.message,{position:"top-center"}):i.info(a.props.flash?.message,{position:"top-center"}),k()}});break;default:Q(y.store().url,{preserveScroll:!0,onSuccess:a=>{a.props.flash?.type==="success"?(F(a.props.newdata?.datas),H(a.props.newdata?.datas),i.success(a.props.flash?.message,{position:"top-center"})):a.props.flash?.type==="error"?i.error(a.props.flash?.message,{position:"top-center"}):i.info(a.props.flash?.message,{position:"top-center"}),k(),m()}});break}},_=e=>{X(y.destory(e).url,{preserveScroll:!0,onStart:()=>C(!0),onSuccess:t=>{t.props.flash?.type==="success"?(i.success(t.props.flash?.message,{position:"top-center"}),O(e),H(t.props.newdata?.datas)):t.props.flash?.type==="error"?i.error(t.props.flash?.message,{position:"top-center"}):i.info(t.props.flash?.message,{position:"top-center"}),k(),m()},onFinish:()=>C(!1),onError:()=>C(!1)})},ee=(e,t)=>{f({...c,id:"",catatan:""}),m();const a=d.find(r=>r.id===t);e?a?(u(r=>r.filter(o=>o.id!==t)),n(r=>r.map(o=>o.id===t?{...o,is_okey_new:e}:o))):(u(r=>[...r,{id:t,is_okey:e}]),n(r=>r.map(o=>o.id===t?{...o,is_okey_new:e}:o))):a?(u(r=>r.filter(o=>o.id!==t)),n(r=>r.map(o=>o.id===t?{...o,is_okey_new:e}:o))):(u(r=>[...r,{id:t,is_okey:e}]),n(r=>r.map(o=>o.id===t?{...o,is_okey_new:e}:o)))};function k(){d.length?(f({...c,id:"",catatan:""}),m(),w("create"),u([]),n(g.map(({is_okey_new:e,...t})=>t))):(f({...c,id:"",catatan:""}),m(),w("create"))}const se=({itemCatatan:e})=>{const t=e.user_id===j.id;return s.jsx(xe,{id:e.id,checked:e.is_okey_new===void 0?e.is_okey:e.is_okey_new,onCheckedChange:t?a=>ee(a,e.id):void 0,disabled:N==="edit"})},te=({itemCatatan:e})=>{const t=e.user_id===j.id;return s.jsx(M,{children:s.jsxs(U,{children:[s.jsx(z,{asChild:!0,children:s.jsx(x,{type:"button",variant:"outline",size:"sm",className:"h-7 w-7 text-muted-foreground",onClick:()=>J(e),disabled:d.length>0||!t,children:s.jsx(ve,{})})}),s.jsx($,{children:"Edit"})]})})},ae=({itemCatatan:e})=>{const t=e.user_id===j.id;return s.jsx(M,{children:s.jsxs(U,{children:[s.jsx(z,{asChild:!0,children:s.jsx(x,{variant:"outline",size:"sm",className:"h-7 w-7 text-muted-foreground",type:"button",onClick:()=>_(e.id),disabled:G||N==="edit"||d.length>0||!t,children:s.jsx(Ne,{})})}),s.jsx($,{children:"Hapus"})]})})};l.useEffect(()=>(B?(Z(),f({...c,berka_id:b.id})):(m(),k(),w("create")),()=>{}),[B]),l.useEffect(()=>{if(p)switch(p.action){case"addcatatan":F(p);break;case"updatecatatan":P(p);break;case"destroycatatan":O(p.id);break;default:return()=>{}}else return()=>{};return()=>{}},[p]),l.useEffect(()=>{R&&re()},[R]);const re=()=>{v.current&&(v.current.scrollTop=v.current.scrollHeight),A(!1)};return s.jsxs(le,{className:"p-0 sm:max-w-3xl 2xl:max-w-4xl top-0 mt-6 translate-y-0",onInteractOutside:e=>{e.preventDefault()},children:[s.jsxs(ne,{className:"px-6 pt-4",children:[s.jsx(de,{className:"text-lg font-semibold text-foreground",children:"Daftar Catatan"}),s.jsxs(ce,{children:["Kegiatan:"," ",b.kegiatan,s.jsx("br",{}),"No. SPM:"," ",b.no_spm]})]}),s.jsx("div",{ref:v,className:"sm:max-h-80 2xl:max-h-120 overflow-y-auto mx-4 border rounded-md",children:s.jsxs(ue,{children:[s.jsx(fe,{children:s.jsxs(S,{children:[s.jsx(T,{className:"w-7"}),s.jsx(T,{children:"Catatan"}),s.jsx(T,{className:"w-40",children:"Verifikator"}),s.jsx(T,{className:"w-28 text-center",children:I&&"Pilih"})]})}),s.jsx(me,{children:K?s.jsx(S,{children:s.jsx(h,{colSpan:4,children:s.jsxs("div",{className:"flex gap-2 items-center",children:[s.jsx(he,{}),"Loading..."]})})}):g.length>0?g.map((e,t)=>s.jsxs(S,{children:[s.jsx(h,{children:s.jsx(se,{itemCatatan:e})}),s.jsxs(h,{children:[s.jsx("div",{className:`whitespace-normal ${e.id===c.id&&"font-medium"}`,children:e.catatan}),s.jsx("div",{className:"text-muted-foreground text-xs pt-1.5",children:e.created_at})]}),s.jsx(h,{children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(be,{className:"h-9 w-9 overflow-hidden rounded-full",children:e.foto?s.jsx(ge,{src:`/storage/foto/small/${e.foto}`,alt:e.name}):s.jsx(ke,{className:"rounded-lg bg-neutral-200 text-black dark:bg-neutral-700 dark:text-white",children:q(e.name)})}),s.jsx("div",{className:"text-sm font-medium text-foreground",children:e.name})]},t)}),s.jsx(h,{className:"text-center",children:I&&s.jsxs("div",{className:"flex gap-2.5 justify-center",children:[s.jsx(te,{itemCatatan:e}),s.jsx(ae,{itemCatatan:e})]})})]},t)):s.jsx(S,{children:s.jsx(h,{colSpan:4,children:"Tidak catatan."})})})]})}),I?s.jsx("form",{onSubmit:V,children:s.jsxs("div",{className:"border-t bg-muted dark:bg-background rounded-b-md px-4 py-4",children:[s.jsx("div",{className:"pb-2",children:s.jsx(je,{message:Y.catatan})}),s.jsxs("div",{className:"flex justify-between gap-2 flex-col-reverse sm:flex-row",children:[s.jsx(x,{type:"button",variant:"outline",onClick:k,tabIndex:4,children:"Reset"}),s.jsx(pe,{id:"catatan",name:"catatan",className:"bg-background",value:c.catatan||"",onChange:e=>f("catatan",e.target.value),placeholder:"Tulis catatan.",disabled:d.length>0,required:!0,tabIndex:1,autoFocus:!0}),s.jsxs("div",{className:"flex flex-col-reverse gap-2 sm:flex-row",children:[s.jsx(x,{variant:"default",type:"submit",tabIndex:2,disabled:E,children:d.length>0||N==="edit"?"Update":"Simpan"}),s.jsx(L,{asChild:!0,children:s.jsx(x,{variant:"outline",tabIndex:3,disabled:E,children:"Tutup"})})]})]})]})}):s.jsx("div",{className:"flex border-t bg-muted dark:bg-background rounded-b-md px-4 py-4",children:s.jsx("div",{className:"ml-auto",children:s.jsx(L,{asChild:!0,children:s.jsx(x,{variant:"outline",tabIndex:1,disabled:E,children:"Tutup"})})})})]})}export{Ve as default};
