import{a as me,r as l,b as ue,g as xe,j as e,H as he}from"./app-CPskstAv.js";import{B as $}from"./button-DVnw63hJ.js";import{d as pe,b as je,T as y,c,e as ge,a as d}from"./table-kKyIuAuy.js";import{S as fe,A as be}from"./app-layout-CP5_9fL3.js";import{B as ke}from"./berkas-sidebar-Y7GCP3S4.js";import{A as ve}from"./app-sidebar-header-Bhh85vkX.js";import{u as Se,l as C,R as Ne}from"./lodash-BDkE5kWn.js";import{b as we}from"./index-DaAGmrkb.js";import{I as _e,a as De,b as ye}from"./input-group-Bx9jBiel.js";import{e as f,S as b,a as k,c as v,d as S,b as I,f as N}from"./select-DwAvJLn8.js";import{H as Ce}from"./heading-CA6ewJV4.js";import{D as T}from"./dialog-cC233ulC.js";import Ie from"./dialog-form-registrasi-CDKDcsS9.js";import Te from"./dialog-detail-berkas-foRNnDZF.js";import Ve from"./dialog-destroy-IU1Jj54w.js";import Be from"./button-update-status-U3FCXjWs.js";import Fe from"./button-catatan-Dh7EpWAa.js";import{L as He}from"./label-icon-status-B1r4PCbu.js";import Me from"./dropdown-action-DxTueMLd.js";import{P as Pe}from"./pagination-CAnHMx_a.js";import Re from"./button-history-Bg0B7Uwp.js";import{S as Ae}from"./separator-DWXuXNo7.js";import{S as Ee}from"./search-CnYQp3Aq.js";/* empty css            */import"./index-AjYOHAR7.js";import"./use-initials-Dg7l8F5j.js";import"./index-B17OepHW.js";import"./Combination-awoxvRvc.js";import"./index-DNPXXR2E.js";import"./dropdown-menu-DZWxzjFm.js";import"./index-RoZEPnYD.js";import"./index-CYbzSx9y.js";import"./index-46n4DGVn.js";import"./index-BvaIFVjI.js";import"./index-Dxbdgbdu.js";import"./index-BZ2HSPaJ.js";import"./index-CTsJdAZR.js";import"./sheet-BS6VOPR3.js";import"./index-D1qKGPHi.js";import"./createLucideIcon-C2iFPrfA.js";import"./index-BOOka7_X.js";import"./index-DE4duBNV.js";import"./tooltip-8RJYWOsU.js";import"./check-BwigAa8m.js";import"./chevrons-up-down-D_QzHG1o.js";import"./index-LxfgKXR4.js";import"./loader-circle-BadshYxY.js";import"./triangle-alert-BLKHHmaF.js";import"./circle-check-D710CbHw.js";import"./dialog-catatan-view-DOXo5FsG.js";import"./checkbox-4w9MF4Kd.js";import"./spinner-5Uae_jPp.js";import"./index-CBGkccfa.js";import"./circle-slash-2-CgS_zfYR.js";import"./chevron-right-Cbo71Pe-.js";import"./input-CDsb02z_.js";import"./input-error-10G6LJWt.js";import"./label-9WXwGcJ8.js";import"./dialog-konfirmasi-sp2d-BNIQeFcp.js";import"./dialog-catatan-Da2PwUZL.js";import"./trash-BjkFRwtO.js";import"./lembar-verifikasi-BEHg69vI.js";import"./eye-Sb-lP6bL.js";import"./sheet-history-CmYrFtzo.js";import"./history-CAtt7JZT.js";const Le=[{name:"15",value:"15"},{name:"30",value:"30"},{name:"60",value:"60"},{name:"100",value:"100"}];function Ge({daftarberkas:t,tahun:Q,menuOption:m,filtered:u,instansi:X,jenisberkas:Y,sumberdana:Z}){const{auth:i}=me().props,[V,x]=l.useState(t.data),[B,w]=l.useState(!1),[O,F]=l.useState(!1),[U,_]=l.useState("create"),[D,p]=l.useState(0),[H,M]=l.useState(!1),[ee,se]=l.useState(null),ae=()=>i.user.roleuser.slug==="admin"||i.user.roleuser.slug==="verifikator"?"admin-verifikator":i.user.roleuser.instansi_id!==null?"instansi."+i.user.roleuser.instansi_id:void 0,[n,h]=l.useState({cari:u.cari||"",load:u.load||"15",instansi:u.instansi||"",jenisspm:u.jenisspm||"",sumberdana:u.sumberdana||""}),re=Se(n),te=l.useCallback(C.debounce(s=>{ue.get(we.main({tahun:Q,statusberkas:m}),s,{preserveScroll:!0,preserveState:!1,replace:!0})},500),[]);l.useEffect(()=>{if(re){const s=Object.keys(C.pickBy(n)).length?C.pickBy(n):"";te(s)}},[n]);function ie(s){h(a=>({...a,cari:s.target.value}))}function ne(){h({load:"15",cari:"",instansi:"",jenisspm:"",sumberdana:""})}const P=s=>{const r=(()=>{switch(s.data.status_berka_id){case 1:return"registrasi";case 2:return"verifikasi";case 3:return"penolakan";case 4:return"sp2d";default:throw new Error("Status tidak valid, harap hubungi admin")}})()===m;x(r?j=>j.some(o=>o.id===s.berka_id)?j.map(o=>{if(o.id===s.berka_id){const W=o.riwayats.find(g=>g.id===s.data.id);if(W)return{...o,riwayats:o.riwayats.filter(g=>g.id!==W.id)};{const g={berka_id:s.data.berka_id,id:s.data.id,status_berka_id:s.data.status_berka_id,user_id:s.data.user_id};return{...o,riwayats:[...o.riwayats,g]}}}return o}):[s.data,...j]:j=>j.filter(z=>z.id!==s.berka_id))},R=s=>{x(a=>a.map(r=>r.id===s.berka_id?{...r,jumlah_catatan:s.jumlah_catatan}:r))},A=s=>{const a={hari:s.hari,hari_ke:s.hari_ke,id:s.id,jam:s.jam,jumlah_catatan:s.jumlah_catatan,kegiatan:s.kegiatan,kode:s.kode,nama_instansi:s.nama_instansi,nama_jenis_berkas:s.nama_jenis_berkas,nama_sumber_dana:s.nama_sumber_dana,no_spm:s.no_spm,riwayats:s.riwayats,status_berka_id:s.status_berka_id,tgl_registrasi:s.tgl_registrasi,tgl_spm:s.tgl_spm};x(r=>[a,...r])},E=s=>{x(a=>a.map(r=>r.id===s.id?{...r,hari_ke:s.hari_ke,id:s.id,kegiatan:s.kegiatan,nama_jenis_berkas:s.nama_jenis_berkas,nama_sumber_dana:s.nama_sumber_dana,no_spm:s.no_spm,tgl_spm:s.tgl_spm}:r))},L=s=>{x(a=>a.filter(r=>r.id!==s))},G=(s,a)=>{switch(_(s),s){case"edit":p(a),w(!0);break;default:w(!0);break}},le=s=>{p(s),F(!0)},oe=s=>{p(s),M(!0)},J=s=>{w(s),s||(p(0),_("create"))},K=s=>{M(s)},q=s=>{F(s),s||(p(0),_("create"))};function de(s,a){switch(a){case 1:return s===2?e.jsx(e.Fragment,{children:"(hari ini expired)"}):s>2?e.jsx(e.Fragment,{children:"(expired)"}):e.jsx(e.Fragment,{children:null});case 2:return s===2?e.jsx(e.Fragment,{children:"(hari ini expired)"}):s>2?e.jsx(e.Fragment,{children:"(expired)"}):e.jsx(e.Fragment,{children:null})}}xe(`${ae()}`,"StatusBerkasEvent",s=>{const a=s.newData.user_id===i.user.id;if(a)return()=>a;if(s.newData.info==="berkas")switch(s.newData.action){case"newBerkas":if(m==="registrasi"&&i.user.roleuser.slug==="admin"||i.user.roleuser.slug==="verifikator")A(s.newData.data);else return()=>s.newData.action;break;case"updateBerkas":E(s.newData);break;case"destroyBerkas":L(s.newData.id);break;case"updateStatus":P(s.newData);break;default:return()=>a}else if(s.newData.info==="catatan")R(s.newData),se(s.newData);else return()=>a});const ce=[{title:"Berkas",href:"#"},{title:m,href:"#"}];return e.jsxs(e.Fragment,{children:[e.jsx(T,{open:B,onOpenChange:J,modal:!0,children:e.jsx(Ie,{modalCrud:B,addNew:A,dataState:D,modeType:U,closeModal:J,updateBerkas:E})}),e.jsx(T,{open:H,onOpenChange:K,modal:!0,children:e.jsx(Te,{isDialog:H,dataState:D,closeModal:K})}),e.jsx(T,{open:O,onOpenChange:q,modal:!0,children:e.jsx(Ve,{dataState:D,closeModal:q,destroyBerkas:L})}),e.jsx(he,{title:"Berkas"}),e.jsx(ke,{}),e.jsx(fe,{className:"py-1",children:e.jsxs("div",{className:"flex flex-1 flex-col space-y-2 pl-2 mt-(--header-height) h-[calc(100svh-var(--header-height))]!",children:[e.jsx(ve,{breadcrumbs:ce,trigger:!0}),e.jsxs("div",{className:"min-h-screen p-4 flex-1 overflow-hidden bg-background shadow-sm rounded-xl border border-sidebar-border/70 md:min-h-min dark:border-sidebar-border",children:[e.jsxs("div",{className:"flex flex-1",children:[e.jsx(Ce,{title:m.charAt(0).toUpperCase()+m.slice(1),description:"Kelola data berkas pada tabel dibawah ini."}),i.user.roleuser.slug==="bendahara"&&m==="registrasi"?e.jsx("div",{className:"ml-auto",children:e.jsx($,{onClick:()=>G("create"),tabIndex:1,children:"Registrasi"})}):""]}),e.jsx(Ae,{className:"mb-4"}),e.jsxs("div",{className:"flex items-center py-4 gap-2",children:[e.jsx("div",{children:e.jsxs(f,{name:"jenisspm",value:n.jenisspm,onValueChange:s=>h(a=>({...a,jenisspm:s})),children:[e.jsx(b,{id:"jenisspm",tabIndex:2,className:"w-full",children:e.jsx(k,{placeholder:"Jenis SPM"})}),e.jsx(v,{children:e.jsxs(S,{children:[e.jsx(I,{children:"Jenis SPM"}),Y.map(s=>e.jsx(N,{value:s.slug,children:s.nama_jenis_berkas},s.slug))]})})]})}),e.jsx("div",{children:e.jsxs(f,{name:"sumberdana",value:n.sumberdana,onValueChange:s=>h(a=>({...a,sumberdana:s})),children:[e.jsx(b,{id:"sumberdana",tabIndex:3,className:"w-full",children:e.jsx(k,{placeholder:"Sumber Dana"})}),e.jsx(v,{children:e.jsxs(S,{children:[e.jsx(I,{children:"Sumber Dana"}),Z.map(s=>e.jsx(N,{value:s.slug,children:s.nama_sumber_dana},s.slug))]})})]})}),e.jsx("div",{children:e.jsxs(f,{name:"instansi",value:n.instansi,onValueChange:s=>h(a=>({...a,instansi:s})),children:[e.jsx(b,{id:"instansi",tabIndex:4,className:"w-full",children:e.jsx(k,{placeholder:"Instansi"})}),e.jsx(v,{children:e.jsxs(S,{children:[e.jsx(I,{children:"Instansi"}),X.map(s=>e.jsx(N,{value:s.slug,children:s.nama_instansi},s.slug))]})})]})}),e.jsx("div",{children:e.jsxs(_e,{children:[e.jsx(De,{id:"cari",name:"cari",value:n.cari,onChange:ie,tabIndex:5,placeholder:"Cari...",autoFocus:!0}),e.jsx(ye,{children:e.jsx(Ee,{})})]})}),e.jsx("div",{children:e.jsx($,{onClick:ne,variant:"outline",size:"icon","aria-label":"Refresh",tabIndex:6,children:e.jsx(Ne,{})})}),e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:"flex gap-2",children:e.jsx("div",{children:e.jsxs(f,{name:"load",value:n.load===""?u.load:n.load,onValueChange:s=>h(a=>({...a,load:s})),children:[e.jsx(b,{id:"load",tabIndex:7,className:"w-full",children:e.jsx(k,{placeholder:u.load})}),e.jsx(v,{children:e.jsx(S,{children:Le.map((s,a)=>e.jsx(N,{value:s.value,children:s.name},a))})})]})})})})]}),e.jsxs(pe,{children:[e.jsx(je,{children:e.jsxs(y,{children:[e.jsx(c,{className:"w-12.5 text-center",children:"No"}),e.jsx(c,{className:"w-35",children:"Waktu Registrasi"}),e.jsx(c,{className:"w-30 text-center",children:"Jenis Berkas"}),e.jsx(c,{children:"Kegiatan"}),e.jsx(c,{className:"w-52 2xl:w-80 hidden 2xl:table-cell text-center",children:"Instansi"}),e.jsx(c,{className:"w-36 text-center",children:"Sumber Dana"}),e.jsx(c,{className:"w-28 text-center",children:"Status"}),e.jsx(c,{className:"w-20 text-center",children:"Pilihan"})]})}),e.jsx(ge,{children:V.length>0?V.map((s,a)=>e.jsxs(y,{children:[e.jsx(d,{className:"text-center",children:t?.meta.from?t?.meta.from+a:a+1}),e.jsxs(d,{className:"text-center",children:[s.hari,e.jsx("br",{}),s.tgl_registrasi,e.jsx("br",{}),s.jam]}),e.jsx(d,{className:"text-center",children:s.nama_jenis_berkas}),e.jsxs(d,{className:"whitespace-normal",children:[e.jsx("div",{className:"2xl:hidden md:w-100 text-muted-foreground mb-0.5 md:truncate",children:s.nama_instansi}),e.jsx("p",{className:"text-sm/6 font-normal",children:s.kegiatan}),e.jsxs("div",{className:"text-muted-foreground sm:grid sm:grid-cols-6",children:[e.jsx("div",{children:"No. Spm"}),e.jsxs("div",{className:"sm:col-span-5",children:[": ",s.no_spm]})]}),e.jsxs("div",{className:"text-muted-foreground sm:grid sm:grid-cols-6",children:[e.jsx("div",{children:"Tgl. Spm"}),e.jsxs("span",{className:"sm:col-span-2",children:[":  ",s.tgl_spm]}),e.jsx("span",{className:"sm:col-span-2 text-destructive",children:de(s.hari_ke,s.status_berka_id)})]}),e.jsxs("div",{className:"flex items-center pt-3",children:[e.jsxs("div",{className:"flex",children:[e.jsx(Re,{dataValue:s}),e.jsx(Fe,{stateCatatans:ee,user:i.user,updateJumlahCatatan:R,dataValue:s})]}),e.jsx(Be,{updateStatusBerkas:P,dataValue:s})]})]}),e.jsx(d,{className:"hidden 2xl:table-cell text-center whitespace-normal",children:s.nama_instansi}),e.jsx(d,{className:"text-center",children:s.nama_sumber_dana}),e.jsx(d,{children:e.jsx(He,{status:s.status_berka_id})}),e.jsx(d,{children:e.jsx("div",{className:"flex justify-center",children:e.jsx(Me,{user:i.user,openModalCrud:G,openDialogDestroy:le,openDialogDetail:oe,dataValue:s.id})})})]},a)):e.jsx(y,{children:e.jsx(d,{colSpan:7,className:"font-normal",children:"Data tidak ditemukan."})})})]}),e.jsxs("div",{className:"grid items-center auto-rows-min gap-4 md:grid-cols-2 py-4",children:[e.jsxs("div",{className:"text-foreground text-sm",children:[t?.meta.from," sampai ",t?.meta.to," dari total: ",t?.meta.total]}),e.jsx("div",{className:"flex flex-1 flex-row-reverse",children:e.jsx(Pe,{links:t.links,meta:t.meta})})]})]})]})})]})}Ge.layout=t=>e.jsx(be,{children:t});export{Ge as default};
