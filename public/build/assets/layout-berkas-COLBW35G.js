import{r as m,j as e,c as P,a as V,L as ce,b as Ie,g as Me,H as Pe}from"./app-BeX5yfZH.js";import{u as Ae,r as de,B as oe}from"./button-B5krPvKU.js";import{T as Be,a as Fe,b as J,c as y,d as Ee,e as w}from"./table-CDkRq6Rn.js";import{S as ue,a as me,b as Le,c as He,d as Ve,e as he,f as pe,g as xe,h as $e,i as Ge,j as Je,A as Oe}from"./app-layout-BC3kZ8fv.js";import{b as M}from"./index-9gvoGEvc.js";import{u as qe,c as We,a as ze,b as Ke}from"./index-BRecdF8i.js";import{P as z}from"./index-DsaDD7fh.js";import{P as Ye}from"./index-DTX97f16.js";import{u as Ze}from"./Combination-CvQPblDd.js";import{c as Qe}from"./createLucideIcon-DsioBRLo.js";import{C as Xe}from"./chevron-right-DUyxW82A.js";import{F as Ue,L as es}from"./label-icon-status-CyEW2hvt.js";import{C as ss}from"./check-CI9dOQvf.js";import{C as as,a as ts}from"./circle-slash-2--Hzdz3qN.js";import{A as rs}from"./app-sidebar-header-CnQ-FLyz.js";import{S as ns}from"./dropdown-menu-C3n0CXPq.js";import{u as is,l as O,R as ls,P as os}from"./pagination-BLa7tQ9W.js";import{I as cs,a as ds,b as us}from"./input-group-Dzwu-sxX.js";import{e as A,S as B,a as F,c as E,d as L,b as q,f as H}from"./select-BxztW5fN.js";import{H as ms}from"./heading-CsiDOhg3.js";import{D as W}from"./dialog-qDcPRMAV.js";import hs from"./dialog-form-registrasi-smU2ccQQ.js";import ps from"./dialog-detail-berkas-B4mzbkpP.js";import xs from"./dialog-destroy-DgMGRLqg.js";import fs from"./button-update-status-B2w8zgcl.js";import js from"./button-catatan-Bu1lS6mg.js";import gs from"./button-history-D3MLFrq2.js";import bs from"./dropdown-action-bTgu2it_.js";import{S as vs}from"./search-DhUqnvxa.js";/* empty css            */import"./use-initials-azjj74vl.js";import"./index-mSGZsbKE.js";import"./index-QTbVAQX2.js";import"./index-Ci6of2N7.js";import"./sheet-C0vmNxdp.js";import"./index-BAPUsNVB.js";import"./index-BOOka7_X.js";import"./index-DE4duBNV.js";import"./tooltip-BqtrmuBl.js";import"./index-CQmGMoIT.js";import"./index-CkZVWT9n.js";import"./chevrons-up-down-CuUkN4sd.js";import"./index-KDn7zmYf.js";import"./loader-circle-CZ-1YUtV.js";import"./triangle-alert-DQi4JdHK.js";import"./circle-check-CAL92OKd.js";import"./dialog-catatan-view-DThWafng.js";import"./checkbox-DK5_aMUk.js";import"./spinner-BdFSMZGa.js";import"./index-CBGkccfa.js";import"./separator-4iF-8bK2.js";import"./index-VjLU_duU.js";import"./input--9wcZeq6.js";import"./input-error-BN8VaVDM.js";import"./label-CMKLJtMj.js";import"./dialog-konfirmasi-sp2d-DXBQ5rP-.js";import"./dialog-catatan-BmoBdJz-.js";import"./trash-DUm0C9Ez.js";import"./lembar-verifikasi-8tEuvBms.js";import"./eye-4f4b7ghX.js";const ks=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Cs=Qe("FileText",ks);var $="Collapsible",[Ss,Va]=We($),[Ns,K]=Ss($),fe=m.forwardRef((a,t)=>{const{__scopeCollapsible:r,open:n,defaultOpen:o,disabled:u,onOpenChange:c,...l}=a,[p,d]=qe({prop:n,defaultProp:o??!1,onChange:c,caller:$});return e.jsx(Ns,{scope:r,disabled:u,contentId:Ze(),open:p,onOpenToggle:m.useCallback(()=>d(h=>!h),[d]),children:e.jsx(z.div,{"data-state":Z(p),"data-disabled":u?"":void 0,...l,ref:t})})});fe.displayName=$;var je="CollapsibleTrigger",ge=m.forwardRef((a,t)=>{const{__scopeCollapsible:r,...n}=a,o=K(je,r);return e.jsx(z.button,{type:"button","aria-controls":o.contentId,"aria-expanded":o.open||!1,"data-state":Z(o.open),"data-disabled":o.disabled?"":void 0,disabled:o.disabled,...n,ref:t,onClick:ze(a.onClick,o.onOpenToggle)})});ge.displayName=je;var Y="CollapsibleContent",be=m.forwardRef((a,t)=>{const{forceMount:r,...n}=a,o=K(Y,a.__scopeCollapsible);return e.jsx(Ye,{present:r||o.open,children:({present:u})=>e.jsx(_s,{...n,ref:t,present:u})})});be.displayName=Y;var _s=m.forwardRef((a,t)=>{const{__scopeCollapsible:r,present:n,children:o,...u}=a,c=K(Y,r),[l,p]=m.useState(n),d=m.useRef(null),h=Ae(t,d),x=m.useRef(0),C=x.current,k=m.useRef(0),_=k.current,g=c.open||l,S=m.useRef(g),f=m.useRef(void 0);return m.useEffect(()=>{const j=requestAnimationFrame(()=>S.current=!1);return()=>cancelAnimationFrame(j)},[]),Ke(()=>{const j=d.current;if(j){f.current=f.current||{transitionDuration:j.style.transitionDuration,animationName:j.style.animationName},j.style.transitionDuration="0s",j.style.animationName="none";const b=j.getBoundingClientRect();x.current=b.height,k.current=b.width,S.current||(j.style.transitionDuration=f.current.transitionDuration,j.style.animationName=f.current.animationName),p(n)}},[c.open,n]),e.jsx(z.div,{"data-state":Z(c.open),"data-disabled":c.disabled?"":void 0,id:c.contentId,hidden:!g,...u,ref:h,style:{"--radix-collapsible-content-height":C?`${C}px`:void 0,"--radix-collapsible-content-width":_?`${_}px`:void 0,...a.style},children:g&&o})});function Z(a){return a?"open":"closed"}var ws=fe;function ys(a){const t=P.c(4);let r;t[0]!==a?({...r}=a,t[0]=a,t[1]=r):r=t[1];let n;return t[2]!==r?(n=e.jsx(ws,{"data-slot":"collapsible",...r}),t[2]=r,t[3]=n):n=t[3],n}function Ds(a){const t=P.c(4);let r;t[0]!==a?({...r}=a,t[0]=a,t[1]=r):r=t[1];let n;return t[2]!==r?(n=e.jsx(ge,{"data-slot":"collapsible-trigger",...r}),t[2]=r,t[3]=n):n=t[3],n}function Ts(a){const t=P.c(4);let r;t[0]!==a?({...r}=a,t[0]=a,t[1]=r):r=t[1];let n;return t[2]!==r?(n=e.jsx(be,{"data-slot":"collapsible-content",...r}),t[2]=r,t[3]=n):n=t[3],n}function Rs(a){const t=P.c(13),{url:r}=V();let n,o,u,c;if(t[0]!==r){const d=[{title:"Laporan",icon:Cs,isActive:r.startsWith("/berkas"),items:[{title:"Jenis SPM",href:"#"},{title:"Jenis Belanja",href:"#"}]}];o=he,t[5]===Symbol.for("react.memo_cache_sentinel")?(c=e.jsx(pe,{children:"Rekapitulasi"}),t[5]=c):c=t[5],n=xe,u=d.map(h=>e.jsx(ys,{asChild:!0,defaultOpen:h.isActive,className:"group/collapsible",children:e.jsxs(ue,{children:[e.jsx(Ds,{asChild:!0,children:e.jsxs(me,{tooltip:h.title,children:[h.icon&&e.jsx(h.icon,{}),e.jsx("span",{children:h.title}),e.jsx(Xe,{className:"ml-auto transition-transform duration-200 group-data-[state=open]/collapsible:rotate-90"})]})}),e.jsx(Ts,{children:e.jsx(Le,{children:h.items?.map(x=>e.jsx(He,{children:e.jsx(Ve,{asChild:!0,isActive:r.startsWith(de(x.href)),children:e.jsx(ce,{href:x.href,prefetch:!0,children:e.jsx("span",{children:x.title})})})},x.title))})})]})},h.title)),t[0]=r,t[1]=n,t[2]=o,t[3]=u,t[4]=c}else n=t[1],o=t[2],u=t[3],c=t[4];let l;t[6]!==n||t[7]!==u?(l=e.jsx(n,{children:u}),t[6]=n,t[7]=u,t[8]=l):l=t[8];let p;return t[9]!==o||t[10]!==c||t[11]!==l?(p=e.jsxs(o,{children:[c,l]}),t[9]=o,t[10]=c,t[11]=l,t[12]=p):p=t[12],p}function Is(){const a=P.c(29),{url:t}=V(),{tahun:r}=V().props;let n,o,u,c,l,p,d,h,x;if(a[0]!==r||a[1]!==t){const f=new Date().getFullYear(),j=[{title:"Registrasi",href:M.main({tahun:r||f,statusberkas:"registrasi"}),icon:Ue},{title:"Verifikasi",href:M.main({tahun:r||f,statusberkas:"verifikasi"}),icon:ss},{title:"Penolakan",href:M.main({tahun:r||f,statusberkas:"penolakan"}),icon:as},{title:"Sp2d",href:M.main({tahun:r||f,statusberkas:"sp2d"}),icon:ts}];c=$e,h="top-(--header-height) h-[calc(100svh-var(--header-height))]!",x="inset",u=Ge,o=he,p="mt-2 py-0",a[11]===Symbol.for("react.memo_cache_sentinel")?(d=e.jsx(pe,{children:"Status"}),a[11]=d):d=a[11],n=xe,l=j.map(b=>e.jsx(ue,{children:e.jsx(me,{asChild:!0,isActive:t.startsWith(de(b.href)),tooltip:{children:b.title},children:e.jsxs(ce,{href:b.href,children:[b.icon&&e.jsx(b.icon,{}),e.jsx("span",{children:b.title})]})})},b.title)),a[0]=r,a[1]=t,a[2]=n,a[3]=o,a[4]=u,a[5]=c,a[6]=l,a[7]=p,a[8]=d,a[9]=h,a[10]=x}else n=a[2],o=a[3],u=a[4],c=a[5],l=a[6],p=a[7],d=a[8],h=a[9],x=a[10];let C;a[12]!==n||a[13]!==l?(C=e.jsx(n,{children:l}),a[12]=n,a[13]=l,a[14]=C):C=a[14];let k;a[15]!==o||a[16]!==p||a[17]!==d||a[18]!==C?(k=e.jsxs(o,{className:p,children:[d,C]}),a[15]=o,a[16]=p,a[17]=d,a[18]=C,a[19]=k):k=a[19];let _;a[20]===Symbol.for("react.memo_cache_sentinel")?(_=e.jsx(Rs,{}),a[20]=_):_=a[20];let g;a[21]!==u||a[22]!==k?(g=e.jsxs(u,{children:[k,_]}),a[21]=u,a[22]=k,a[23]=g):g=a[23];let S;return a[24]!==c||a[25]!==h||a[26]!==x||a[27]!==g?(S=e.jsx(c,{className:h,variant:x,children:g}),a[24]=c,a[25]=h,a[26]=x,a[27]=g,a[28]=S):S=a[28],S}const Ms=[{name:"15",value:"15"},{name:"30",value:"30"},{name:"60",value:"60"},{name:"100",value:"100"}];function Ps({daftarberkas:a,tahun:t,menuOption:r,filtered:n,instansi:o,jenisberkas:u,sumberdana:c}){const{auth:l}=V().props,[p,d]=m.useState(a.data),[h,x]=m.useState(!1),[C,k]=m.useState(!1),[_,g]=m.useState("create"),[S,f]=m.useState(0),[j,b]=m.useState(!1),[ve,ke]=m.useState(null),Ce=()=>l.user.roleuser.slug==="admin"||l.user.roleuser.slug==="verifikator"?"admin-verifikator":l.user.roleuser.instansi_id!==null?"instansi."+l.user.roleuser.instansi_id:void 0,[N,D]=m.useState({cari:n.cari||"",load:n.load||"15",instansi:n.instansi||"",jenisspm:n.jenisspm||"",sumberdana:n.sumberdana||""}),Se=is(N),Ne=m.useCallback(O.debounce(s=>{Ie.get(M.main({tahun:t,statusberkas:r}),s,{only:["daftarberkas","filtered"],preserveScroll:!0})},500),[]);m.useEffect(()=>{if(Se){const s=Object.keys(O.pickBy(N)).length?O.pickBy(N):"";Ne(s)}},[N]);function _e(s){D(i=>({...i,cari:s.target.value}))}function we(){D({load:"15",cari:"",instansi:"",jenisspm:"",sumberdana:""})}const Q=s=>{const v=(()=>{switch(s.data.status_berka_id){case 1:return"registrasi";case 2:return"verifikasi";case 3:return"penolakan";case 4:return"sp2d";default:throw new Error("Status tidak valid, harap hubungi admin")}})()===r;d(v?R=>R.some(T=>T.id===s.berka_id)?R.map(T=>{const le=T.riwayats.find(I=>I.id===s.data.id);let G;if(le)G=T.riwayats.filter(I=>I.id!==le.id);else{const I={berka_id:s.data.berka_id,id:s.data.id,status_berka_id:s.data.status_berka_id,user_id:s.data.user_id};G=[...T.riwayats,I]}return{...T,riwayats:G}}):[s.data,...R]:R=>R.filter(ie=>ie.id!==s.berka_id))},X=s=>{d(i=>i.map(v=>v.id===s.berka_id?{...v,jumlah_catatan:s.jumlah_catatan}:v))},U=s=>{const i={hari:s.hari,hari_ke:s.hari_ke,id:s.id,jam:s.jam,jumlah_catatan:s.jumlah_catatan,kegiatan:s.kegiatan,kode:s.kode,nama_instansi:s.nama_instansi,nama_jenis_berkas:s.nama_jenis_berkas,nama_sumber_dana:s.nama_sumber_dana,no_spm:s.no_spm,riwayats:s.riwayats,status_berka_id:s.status_berka_id,tgl_registrasi:s.tgl_registrasi,tgl_spm:s.tgl_spm};d(v=>[i,...v])},ee=s=>{d(i=>i.map(v=>v.id===s.id?{...v,hari_ke:s.hari_ke,id:s.id,kegiatan:s.kegiatan,nama_jenis_berkas:s.nama_jenis_berkas,nama_sumber_dana:s.nama_sumber_dana,no_spm:s.no_spm,tgl_spm:s.tgl_spm}:v))},se=s=>{d(i=>i.filter(v=>v.id!==s))},ae=(s,i)=>{switch(g(s),s){case"edit":f(i),x(!0);break;default:x(!0);break}},ye=s=>{f(s),k(!0)},De=s=>{f(s),b(!0)},te=s=>{x(s),s||(f(0),g("create"))},re=s=>{b(s)},ne=s=>{k(s),s||(f(0),g("create"))};function Te(s,i){switch(i){case 1:return s===2?e.jsx(e.Fragment,{children:"(hari ini expired)"}):s>2?e.jsx(e.Fragment,{children:"(expired)"}):e.jsx(e.Fragment,{children:null});case 2:return s===2?e.jsx(e.Fragment,{children:"(hari ini expired)"}):s>2?e.jsx(e.Fragment,{children:"(expired)"}):e.jsx(e.Fragment,{children:null})}}Me(`${Ce()}`,"StatusBerkasEvent",s=>{const i=s.newData.user_id===l.user.id;switch(s.newData.info){case"berkas":if(s.newData.action==="newBerkas")if(r==="registrasi"&&l.user.roleuser.slug==="admin"||l.user.roleuser.slug==="verifikator")U(s.newData.data);else return()=>s.newData.info;else if(s.newData.action==="updateBerkas")if(l.user.roleuser.slug!=="bendahara")ee(s.newData);else return()=>s.newData.info;else if(s.newData.action==="destroyBerkas")if(l.user.roleuser.slug!=="bendahara")se(s.newData.id);else return()=>s.newData.info;else s.newData.action==="updateStatus"&&Q(s.newData);break;case"catatan":if(i)return()=>i;X(s.newData),ke(s.newData);break;default:return()=>i}});const Re=[{title:"Berkas",href:"#"},{title:r,href:"#"}];return e.jsxs(e.Fragment,{children:[e.jsx(W,{open:h,onOpenChange:te,modal:!0,children:e.jsx(hs,{modalCrud:h,addNew:U,dataState:S,modeType:_,closeModal:te,updateBerkas:ee})}),e.jsx(W,{open:j,onOpenChange:re,modal:!0,children:e.jsx(ps,{isDialog:j,dataState:S,closeModal:re})}),e.jsx(W,{open:C,onOpenChange:ne,modal:!0,children:e.jsx(xs,{dataState:S,closeModal:ne,destroyBerkas:se})}),e.jsx(Pe,{title:"Berkas"}),e.jsx(Is,{}),e.jsx(Je,{className:"py-1",children:e.jsxs("div",{className:"flex flex-1 flex-col space-y-2 pl-2 mt-(--header-height) h-[calc(100svh-var(--header-height))]!",children:[e.jsx(rs,{breadcrumbs:Re,trigger:!0}),e.jsxs("div",{className:"min-h-screen p-4 flex-1 overflow-hidden bg-background shadow-sm rounded-xl border border-sidebar-border/70 md:min-h-min dark:border-sidebar-border",children:[e.jsxs("div",{className:"flex flex-1",children:[e.jsx(ms,{title:r.charAt(0).toUpperCase()+r.slice(1),description:"Kelola data berkas pada tabel dibawah ini."}),l.user.roleuser.slug==="bendahara"&&r==="registrasi"?e.jsx("div",{className:"ml-auto",children:e.jsx(oe,{onClick:()=>ae("create"),children:"Registrasi"})}):""]}),e.jsx(ns,{className:"mb-4"}),e.jsxs("div",{className:"flex items-center py-4 gap-2",children:[e.jsx("div",{children:e.jsxs(A,{name:"jenisspm",value:N.jenisspm,onValueChange:s=>D(i=>({...i,jenisspm:s})),children:[e.jsx(B,{tabIndex:1,className:"w-full",children:e.jsx(F,{placeholder:"Jenis SPM"})}),e.jsx(E,{children:e.jsxs(L,{children:[e.jsx(q,{children:"Jenis SPM"}),u.map(s=>e.jsx(H,{value:s.slug,children:s.nama_jenis_berkas},s.slug))]})})]})}),e.jsx("div",{children:e.jsxs(A,{name:"sumberdana",value:N.sumberdana,onValueChange:s=>D(i=>({...i,sumberdana:s})),children:[e.jsx(B,{tabIndex:1,className:"w-full",children:e.jsx(F,{placeholder:"Sumber Dana"})}),e.jsx(E,{children:e.jsxs(L,{children:[e.jsx(q,{children:"Sumber Dana"}),c.map(s=>e.jsx(H,{value:s.slug,children:s.nama_sumber_dana},s.slug))]})})]})}),e.jsx("div",{children:e.jsxs(A,{name:"instansi",value:N.instansi,onValueChange:s=>D(i=>({...i,instansi:s})),children:[e.jsx(B,{tabIndex:1,className:"w-full",children:e.jsx(F,{placeholder:"Instansi"})}),e.jsx(E,{children:e.jsxs(L,{children:[e.jsx(q,{children:"Instansi"}),o.map(s=>e.jsx(H,{value:s.slug,children:s.nama_instansi},s.slug))]})})]})}),e.jsx("div",{children:e.jsxs(cs,{children:[e.jsx(ds,{id:"cari",name:"cari",value:N.cari,onChange:_e,placeholder:"Cari...",autoFocus:!0}),e.jsx(us,{children:e.jsx(vs,{})})]})}),e.jsx("div",{children:e.jsx(oe,{onClick:we,variant:"outline",size:"icon","aria-label":"Refresh",children:e.jsx(ls,{})})}),e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:"flex gap-2",children:e.jsx("div",{children:e.jsxs(A,{name:"load",value:N.load===""?n.load:N.load,onValueChange:s=>D(i=>({...i,load:s})),children:[e.jsx(B,{tabIndex:1,className:"w-full",children:e.jsx(F,{placeholder:n.load})}),e.jsx(E,{children:e.jsx(L,{children:Ms.map((s,i)=>e.jsx(H,{value:s.value,children:s.name},i))})})]})})})})]}),e.jsxs(Be,{children:[e.jsx(Fe,{children:e.jsxs(J,{children:[e.jsx(y,{className:"w-12.5 text-center",children:"No"}),e.jsx(y,{className:"w-35",children:"Waktu Registrasi"}),e.jsx(y,{className:"w-30 text-center",children:"Jenis Berkas"}),e.jsx(y,{children:"Kegiatan"}),e.jsx(y,{className:"w-52 2xl:w-80 hidden 2xl:table-cell text-center",children:"Instansi"}),e.jsx(y,{className:"w-36 text-center",children:"Sumber Dana"}),e.jsx(y,{className:"w-28 text-center",children:"Status"}),e.jsx(y,{className:"w-20 text-center",children:"Pilihan"})]})}),e.jsx(Ee,{children:p.length>0?p.map((s,i)=>e.jsxs(J,{children:[e.jsx(w,{className:"text-center",children:a?.meta.from?a?.meta.from+i:i+1}),e.jsxs(w,{className:"text-center",children:[s.hari,e.jsx("br",{}),s.tgl_registrasi,e.jsx("br",{}),s.jam]}),e.jsx(w,{className:"text-center",children:s.nama_jenis_berkas}),e.jsxs(w,{className:"whitespace-normal",children:[e.jsx("div",{className:"2xl:hidden md:w-100 text-muted-foreground mb-0.5 md:truncate",children:s.nama_instansi}),e.jsx("p",{className:"text-sm/6 font-normal",children:s.kegiatan}),e.jsxs("div",{className:"text-muted-foreground sm:grid sm:grid-cols-6",children:[e.jsx("div",{children:"No. Spm"}),e.jsxs("div",{className:"sm:col-span-5",children:[": ",s.no_spm]})]}),e.jsxs("div",{className:"text-muted-foreground sm:grid sm:grid-cols-6",children:[e.jsx("div",{children:"Tgl. Spm"}),e.jsxs("span",{className:"sm:col-span-2",children:[":  ",s.tgl_spm]}),e.jsx("span",{className:"sm:col-span-2 text-destructive",children:Te(s.hari_ke,s.status_berka_id)})]}),e.jsxs("div",{className:"flex items-center pt-3",children:[e.jsxs("div",{className:"flex",children:[e.jsx(gs,{dataValue:s}),e.jsx(js,{stateCatatans:ve,user:l.user,updateJumlahCatatan:X,dataValue:s})]}),e.jsx(fs,{updateStatusBerkas:Q,dataValue:s})]})]}),e.jsx(w,{className:"hidden 2xl:table-cell text-center whitespace-normal",children:s.nama_instansi}),e.jsx(w,{className:"text-center",children:s.nama_sumber_dana}),e.jsx(w,{children:e.jsx(es,{status:s.status_berka_id})}),e.jsx(w,{children:e.jsx("div",{className:"flex justify-center",children:e.jsx(bs,{user:l.user,openModalCrud:ae,openDialogDestroy:ye,openDialogDetail:De,dataValue:s.id})})})]},i)):e.jsx(J,{children:e.jsx(w,{colSpan:7,className:"font-normal",children:"Tidak ada data. Silahkan klik tombol Tambah untuk menambah."})})})]}),e.jsxs("div",{className:"grid items-center auto-rows-min gap-4 md:grid-cols-2 py-4",children:[e.jsxs("div",{className:"text-foreground text-sm",children:[a?.meta.from," sampai ",a?.meta.to," dari total: ",a?.meta.total]}),e.jsx("div",{className:"flex flex-1 flex-row-reverse",children:e.jsx(os,{links:a.links,meta:a.meta})})]})]})]})})]})}Ps.layout=a=>e.jsx(Oe,{children:a});export{Ps as default};
