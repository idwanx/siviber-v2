import{r as c,j as e,c as M,u as H,L as se,a as Ne,f as _e,H as ye}from"./app-BgmPP0GG.js";import{e as te,f as re,j as we,k as De,l as Te,c as ie,d as ne,b as le,g as Re,h as Ie,S as Me,A as Pe}from"./app-layout-CSzWMqvu.js";import{b as I}from"./index-CZ-fgGLA.js";import{u as Ae,r as oe,B as ae}from"./button-C4Wn7Ehw.js";import{b as Be,c as Ee,a as Le,u as Fe}from"./index-LamC3X5J.js";import{P as $}from"./index-B2_YVLmQ.js";import{P as He}from"./index-Jd2hf6Du.js";import{u as $e}from"./Combination-D0HGEn81.js";import{c as Ve}from"./createLucideIcon-C-GJ47bQ.js";import{C as Ge}from"./chevron-right-Bahs0ceT.js";import{F as Oe,L as qe}from"./label-icon-status-CANO83Rp.js";import{C as Je}from"./check-BAKfr9Wc.js";import{C as We,a as ze}from"./circle-slash-2-CvembrlZ.js";import{A as Ke}from"./app-sidebar-header-CdRff6bv.js";import{H as Ye}from"./heading-BxyctDOE.js";import{S as Ze}from"./separator-DMCBDHHt.js";import{T as Qe,a as Xe,b as E,c as y,d as Ue,e as _}from"./table-CkWREEG_.js";import{S as ea,a as aa,b as sa,c as ta,d as ra,e as ia}from"./select-Cewuf_k1.js";import{u as na,l as L,R as la,P as oa}from"./lodash-BcS_fJGJ.js";import ca from"./dropdown-action-q5QXF3q6.js";import da from"./button-update-status-3qA4DER1.js";import ua from"./button-catatan-ssDW6nDI.js";import ma from"./button-history-DLBztX4O.js";import pa from"./dialog-form-registrasi-AOUwTfhx.js";import{D as F}from"./dialog-df4iQlWH.js";import ha from"./dialog-destroy-D4nNBC1B.js";import xa from"./dialog-detail-berkas-D33qpDU-.js";import{I as fa,a as ja,b as ga}from"./input-group-bw8fhRdl.js";import{S as ba}from"./search-C_uPGaKS.js";import"./app-DOfo3cv0.js";import"./use-initials-CT6YK1N_.js";import"./dropdown-menu-CX-CMgX2.js";import"./index-B-Uc-XAr.js";import"./index-BHJfw3ue.js";import"./index-BTFfmvd2.js";import"./index-CmfPWyNt.js";import"./index-DWtLOuyK.js";import"./index-BHPxJQcg.js";import"./sheet-Bct4WILz.js";import"./index-WyWT03Oy.js";import"./index-BOOka7_X.js";import"./index-DE4duBNV.js";import"./tooltip-Hc-403zk.js";import"./chevrons-up-down-7ptKa6s3.js";import"./index-DxMgCRM1.js";import"./loader-circle-B7sMNMm9.js";import"./triangle-alert-NPh8MHm1.js";import"./circle-check-D46QRyai.js";import"./dialog-catatan-view-DIKVeQ71.js";import"./checkbox-CjihOasc.js";import"./spinner-BdfMUHyn.js";import"./index-CBGkccfa.js";import"./eye-avCN0w18.js";import"./dialog-konfirmasi-sp2d-DpLTBgtI.js";import"./dialog-catatan-2X5TJEfg.js";import"./input-BRyXp-G7.js";import"./input-error-C2jb0j4n.js";import"./trash-BHD6qwwN.js";import"./label-06piaJxo.js";const va=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],ka=Ve("FileText",va);var P="Collapsible",[Ca,Fs]=Ee(P),[Sa,V]=Ca(P),ce=c.forwardRef((s,t)=>{const{__scopeCollapsible:r,open:i,defaultOpen:n,disabled:d,onOpenChange:l,...p}=s,[h,m]=Be({prop:i,defaultProp:n??!1,onChange:l,caller:P});return e.jsx(Sa,{scope:r,disabled:d,contentId:$e(),open:h,onOpenToggle:c.useCallback(()=>m(u=>!u),[m]),children:e.jsx($.div,{"data-state":O(h),"data-disabled":d?"":void 0,...p,ref:t})})});ce.displayName=P;var de="CollapsibleTrigger",ue=c.forwardRef((s,t)=>{const{__scopeCollapsible:r,...i}=s,n=V(de,r);return e.jsx($.button,{type:"button","aria-controls":n.contentId,"aria-expanded":n.open||!1,"data-state":O(n.open),"data-disabled":n.disabled?"":void 0,disabled:n.disabled,...i,ref:t,onClick:Le(s.onClick,n.onOpenToggle)})});ue.displayName=de;var G="CollapsibleContent",me=c.forwardRef((s,t)=>{const{forceMount:r,...i}=s,n=V(G,s.__scopeCollapsible);return e.jsx(He,{present:r||n.open,children:({present:d})=>e.jsx(Na,{...i,ref:t,present:d})})});me.displayName=G;var Na=c.forwardRef((s,t)=>{const{__scopeCollapsible:r,present:i,children:n,...d}=s,l=V(G,r),[p,h]=c.useState(i),m=c.useRef(null),u=Ae(t,m),x=c.useRef(0),v=x.current,S=c.useRef(0),N=S.current,j=l.open||p,g=c.useRef(j),k=c.useRef(void 0);return c.useEffect(()=>{const f=requestAnimationFrame(()=>g.current=!1);return()=>cancelAnimationFrame(f)},[]),Fe(()=>{const f=m.current;if(f){k.current=k.current||{transitionDuration:f.style.transitionDuration,animationName:f.style.animationName},f.style.transitionDuration="0s",f.style.animationName="none";const C=f.getBoundingClientRect();x.current=C.height,S.current=C.width,g.current||(f.style.transitionDuration=k.current.transitionDuration,f.style.animationName=k.current.animationName),h(i)}},[l.open,i]),e.jsx($.div,{"data-state":O(l.open),"data-disabled":l.disabled?"":void 0,id:l.contentId,hidden:!j,...d,ref:u,style:{"--radix-collapsible-content-height":v?`${v}px`:void 0,"--radix-collapsible-content-width":N?`${N}px`:void 0,...s.style},children:j&&n})});function O(s){return s?"open":"closed"}var _a=ce;function ya(s){const t=M.c(4);let r;t[0]!==s?({...r}=s,t[0]=s,t[1]=r):r=t[1];let i;return t[2]!==r?(i=e.jsx(_a,{"data-slot":"collapsible",...r}),t[2]=r,t[3]=i):i=t[3],i}function wa(s){const t=M.c(4);let r;t[0]!==s?({...r}=s,t[0]=s,t[1]=r):r=t[1];let i;return t[2]!==r?(i=e.jsx(ue,{"data-slot":"collapsible-trigger",...r}),t[2]=r,t[3]=i):i=t[3],i}function Da(s){const t=M.c(4);let r;t[0]!==s?({...r}=s,t[0]=s,t[1]=r):r=t[1];let i;return t[2]!==r?(i=e.jsx(me,{"data-slot":"collapsible-content",...r}),t[2]=r,t[3]=i):i=t[3],i}function Ta(s){const t=M.c(13),{url:r}=H();let i,n,d,l;if(t[0]!==r){const m=[{title:"Laporan",icon:ka,isActive:r.startsWith("/berkas"),items:[{title:"Jenis Berkas",href:"#"},{title:"Jenis Belanja",href:"#"}]}];n=ie,t[5]===Symbol.for("react.memo_cache_sentinel")?(l=e.jsx(ne,{children:"Rekapitulasi"}),t[5]=l):l=t[5],i=le,d=m.map(u=>e.jsx(ya,{asChild:!0,defaultOpen:u.isActive,className:"group/collapsible",children:e.jsxs(te,{children:[e.jsx(wa,{asChild:!0,children:e.jsxs(re,{tooltip:u.title,children:[u.icon&&e.jsx(u.icon,{}),e.jsx("span",{children:u.title}),e.jsx(Ge,{className:"ml-auto transition-transform duration-200 group-data-[state=open]/collapsible:rotate-90"})]})}),e.jsx(Da,{children:e.jsx(we,{children:u.items?.map(x=>e.jsx(De,{children:e.jsx(Te,{asChild:!0,isActive:r.startsWith(oe(x.href)),children:e.jsx(se,{href:x.href,prefetch:!0,children:e.jsx("span",{children:x.title})})})},x.title))})})]})},u.title)),t[0]=r,t[1]=i,t[2]=n,t[3]=d,t[4]=l}else i=t[1],n=t[2],d=t[3],l=t[4];let p;t[6]!==i||t[7]!==d?(p=e.jsx(i,{children:d}),t[6]=i,t[7]=d,t[8]=p):p=t[8];let h;return t[9]!==n||t[10]!==l||t[11]!==p?(h=e.jsxs(n,{children:[l,p]}),t[9]=n,t[10]=l,t[11]=p,t[12]=h):h=t[12],h}function Ra(){const s=M.c(29),{url:t}=H(),{tahun:r}=H().props;let i,n,d,l,p,h,m,u,x;if(s[0]!==r||s[1]!==t){const k=new Date().getFullYear(),f=[{title:"Registrasi",href:I.main({tahun:r||k,statusberkas:"registrasi"}),icon:Oe},{title:"Verifikasi",href:I.main({tahun:r||k,statusberkas:"verifikasi"}),icon:Je},{title:"Penolakan",href:I.main({tahun:r||k,statusberkas:"penolakan"}),icon:We},{title:"Sp2d",href:I.main({tahun:r||k,statusberkas:"sp2d"}),icon:ze}];l=Re,u="top-(--header-height) h-[calc(100svh-var(--header-height))]!",x="inset",d=Ie,n=ie,h="mt-2 py-0",s[11]===Symbol.for("react.memo_cache_sentinel")?(m=e.jsx(ne,{children:"Status"}),s[11]=m):m=s[11],i=le,p=f.map(C=>e.jsx(te,{children:e.jsx(re,{asChild:!0,isActive:t.startsWith(oe(C.href)),tooltip:{children:C.title},children:e.jsxs(se,{href:C.href,only:["daftarberkas","tahun","menuOption","filtered"],children:[C.icon&&e.jsx(C.icon,{}),e.jsx("span",{children:C.title})]})})},C.title)),s[0]=r,s[1]=t,s[2]=i,s[3]=n,s[4]=d,s[5]=l,s[6]=p,s[7]=h,s[8]=m,s[9]=u,s[10]=x}else i=s[2],n=s[3],d=s[4],l=s[5],p=s[6],h=s[7],m=s[8],u=s[9],x=s[10];let v;s[12]!==i||s[13]!==p?(v=e.jsx(i,{children:p}),s[12]=i,s[13]=p,s[14]=v):v=s[14];let S;s[15]!==n||s[16]!==h||s[17]!==m||s[18]!==v?(S=e.jsxs(n,{className:h,children:[m,v]}),s[15]=n,s[16]=h,s[17]=m,s[18]=v,s[19]=S):S=s[19];let N;s[20]===Symbol.for("react.memo_cache_sentinel")?(N=e.jsx(Ta,{}),s[20]=N):N=s[20];let j;s[21]!==d||s[22]!==S?(j=e.jsxs(d,{children:[S,N]}),s[21]=d,s[22]=S,s[23]=j):j=s[23];let g;return s[24]!==l||s[25]!==u||s[26]!==x||s[27]!==j?(g=e.jsx(l,{className:u,variant:x,children:j}),s[24]=l,s[25]=u,s[26]=x,s[27]=j,s[28]=g):g=s[28],g}const Ia=[{name:"15",value:"15"},{name:"30",value:"30"},{name:"60",value:"60"},{name:"100",value:"100"}],Ma=({auth:s,daftarberkas:t,tahun:r,menuOption:i,filtered:n})=>{const[d,l]=c.useState(t.data),[p,h]=c.useState(!1),[m,u]=c.useState(!1),[x,v]=c.useState(!1),[S,N]=c.useState("create"),[j,g]=c.useState(0),[k,f]=c.useState(!1),[C,pe]=c.useState(null),he=()=>s.user.roleuser.slug==="admin"||s.user.roleuser.slug==="verifikator"?"admin-verifikator":s.user.roleuser.instansi_id!==null?"instansi."+s.user.roleuser.instansi_id:void 0,[w,A]=c.useState({cari:n.cari||"",load:n.load||""}),xe=na(w),fe=c.useCallback(L.debounce(a=>{Ne.get(I.main({tahun:r,statusberkas:i}),a,{replace:!0,preserveScroll:!0,preserveState:!0})},500),[]);c.useEffect(()=>{if(xe){const a=Object.keys(L.pickBy(w)).length?L.pickBy(w):"";fe(a)}},[w]);function je(a){A(o=>({...o,cari:a.target.value}))}function ge(a){A(o=>({...o,load:a}))}function be(){A({load:"",cari:""})}const q=a=>{const b=(()=>{switch(a.data.status_berka_id){case 1:return"registrasi";case 2:return"verifikasi";case 3:return"penolakan";case 4:return"sp2d";default:throw new Error("Status tidak valid, harap hubungi admin")}})()===i;l(b?T=>T.some(D=>D.id===a.berka_id)?T.map(D=>{const ee=D.riwayats.find(R=>R.id===a.data.id);let B;if(ee)B=D.riwayats.filter(R=>R.id!==ee.id);else{const R={berka_id:a.data.berka_id,id:a.data.id,status_berka_id:a.data.status_berka_id,user_id:a.data.user_id};B=[...D.riwayats,R]}return{...D,riwayats:B}}):[a.data,...T]:T=>T.filter(U=>U.id!==a.berka_id))},J=a=>{l(o=>o.map(b=>b.id===a.berka_id?{...b,jumlah_catatan:a.jumlah_catatan}:b))},W=a=>{const o={hari:a.hari,hari_ke:a.hari_ke,id:a.id,jam:a.jam,jumlah_catatan:a.jumlah_catatan,kegiatan:a.kegiatan,kode:a.kode,nama_instansi:a.nama_instansi,nama_jenis_berkas:a.nama_jenis_berkas,nama_sumber_dana:a.nama_sumber_dana,no_spm:a.no_spm,riwayats:a.riwayats,status_berka_id:a.status_berka_id,tgl_registrasi:a.tgl_registrasi,tgl_spm:a.tgl_spm};l(b=>[o,...b])},z=a=>{l(o=>o.map(b=>b.id===a.id?{...b,hari_ke:a.hari_ke,id:a.id,kegiatan:a.kegiatan,nama_jenis_berkas:a.nama_jenis_berkas,nama_sumber_dana:a.nama_sumber_dana,no_spm:a.no_spm,tgl_spm:a.tgl_spm}:b))},K=a=>{l(o=>o.filter(b=>b.id!==a))},Y=(a,o)=>{switch(N(a),a){case"update":g(o),u(!0);break;default:u(!0);break}},ve=a=>{g(a),v(!0)},ke=a=>{g(a),f(!0)},Z=a=>{u(a),a||(g(0),N("create"))},Q=a=>{f(a)},X=a=>{v(a),a||(g(0),N("create"))};function Ce(a,o){switch(o){case 1:return a===2?e.jsx(e.Fragment,{children:"(hari ini expired)"}):a>2?e.jsx(e.Fragment,{children:"(expired)"}):e.jsx(e.Fragment,{children:null});case 2:return a===2?e.jsx(e.Fragment,{children:"(hari ini expired)"}):a>2?e.jsx(e.Fragment,{children:"(expired)"}):e.jsx(e.Fragment,{children:null})}}_e(`${he()}`,"StatusBerkasEvent",a=>{const o=a.newData.user_id===s.user.id;switch(a.newData.info){case"berkas":if(a.newData.action==="newBerkas")if(i==="registrasi"&&s.user.roleuser.slug==="admin"||s.user.roleuser.slug==="verifikator")W(a.newData.data);else return()=>a.newData.info;else a.newData.action==="updateBerkas"?z(a.newData):a.newData.action==="destroyBerkas"?K(a.newData.id):a.newData.action==="updateStatus"&&q(a.newData);break;case"catatan":if(o)return()=>o;J(a.newData),pe(a.newData);break;default:return()=>o}}),c.useEffect(()=>(t&&l(t.data),()=>{}),[t]);const Se=[{title:"Berkas",href:"#"},{title:i,href:"#"}];return e.jsxs(e.Fragment,{children:[e.jsx(F,{open:m,onOpenChange:Z,modal:!0,children:e.jsx(pa,{modalCrud:m,addNew:W,dataState:j,modeType:S,closeModal:Z,updateBerkas:z})}),e.jsx(F,{open:k,onOpenChange:Q,modal:!0,children:e.jsx(xa,{isDialog:k,dataState:j,closeModal:Q})}),e.jsx(F,{open:x,onOpenChange:X,modal:!0,children:e.jsx(ha,{dataState:j,closeModal:X,destroyBerkas:K})}),e.jsx(Ra,{}),e.jsx(ye,{title:"Berkas"}),e.jsx(Me,{className:"py-1",children:e.jsxs("main",{className:"flex flex-1 flex-col space-y-2 pl-2 mt-(--header-height) h-[calc(100svh-var(--header-height))]!",children:[e.jsx(Ke,{breadcrumbs:Se,trigger:!0}),e.jsxs("div",{className:"min-h-screen p-4 flex-1 overflow-hidden bg-background shadow-sm rounded-xl border border-sidebar-border/70 md:min-h-min dark:border-sidebar-border",children:[e.jsxs("div",{className:"flex flex-1",children:[e.jsx(Ye,{title:i.charAt(0).toUpperCase()+i.slice(1),description:"Kelola data berkas pada tabel dibawah ini."}),s.user.roleuser.slug==="bendahara"&&i==="registrasi"?e.jsx("div",{className:"ml-auto",children:e.jsx(ae,{onClick:()=>Y("create"),children:"Registrasi"})}):""]}),e.jsx(Ze,{className:"mb-4"}),e.jsxs("div",{className:"flex items-center py-4 gap-2",children:[e.jsx("div",{children:e.jsxs(ea,{name:"load",value:w.load===""?n.load:w.load,onValueChange:a=>ge(a),children:[e.jsx(aa,{tabIndex:1,className:"w-full",children:e.jsx(sa,{placeholder:n.load})}),e.jsx(ta,{children:e.jsx(ra,{children:Ia.map((a,o)=>e.jsx(ia,{value:a.value,children:a.name},o))})})]})}),e.jsx("div",{children:e.jsxs(fa,{children:[e.jsx(ja,{id:"cari",name:"cari",value:w.cari,onChange:je,placeholder:"Cari..."}),e.jsx(ga,{children:e.jsx(ba,{})})]})}),e.jsx("div",{children:e.jsx(ae,{onClick:be,variant:"outline",size:"icon","aria-label":"Refresh",children:e.jsx(la,{})})}),e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:"flex gap-2",children:"-"})})]}),e.jsxs(Qe,{children:[e.jsx(Xe,{children:e.jsxs(E,{children:[e.jsx(y,{className:"w-12.5 text-center",children:"No"}),e.jsx(y,{className:"w-35",children:"Waktu Registrasi"}),e.jsx(y,{className:"w-30 text-center",children:"Jenis Berkas"}),e.jsx(y,{children:"Kegiatan"}),e.jsx(y,{className:"w-52 2xl:w-80 hidden 2xl:table-cell text-center",children:"Instansi"}),e.jsx(y,{className:"w-36 text-center",children:"Sumber Dana"}),e.jsx(y,{className:"w-28 text-center",children:"Status"}),e.jsx(y,{className:"w-20 text-center",children:"Pilihan"})]})}),e.jsx(Ue,{children:d.length>0?d.map((a,o)=>e.jsxs(E,{children:[e.jsx(_,{className:"text-center",children:t?.meta.from?t?.meta.from+o:o+1}),e.jsxs(_,{className:"text-center",children:[a.hari,e.jsx("br",{}),a.tgl_registrasi,e.jsx("br",{}),a.jam]}),e.jsx(_,{className:"text-center",children:a.nama_jenis_berkas}),e.jsxs(_,{className:"whitespace-normal",children:[e.jsx("div",{className:"2xl:hidden md:w-100 text-muted-foreground mb-0.5 md:truncate",children:a.nama_instansi}),e.jsx("p",{className:"text-sm/6 font-medium",children:a.kegiatan}),e.jsxs("div",{className:"text-muted-foreground sm:grid sm:grid-cols-6",children:[e.jsx("div",{children:"No. Spm"}),e.jsxs("div",{className:"sm:col-span-5",children:[": ",a.no_spm]})]}),e.jsxs("div",{className:"text-muted-foreground sm:grid sm:grid-cols-6",children:[e.jsx("div",{children:"Tgl. Spm"}),e.jsxs("span",{className:"sm:col-span-2",children:[":  ",a.tgl_spm]}),e.jsx("span",{className:"sm:col-span-2 text-destructive",children:Ce(a.hari_ke,a.status_berka_id)})]}),e.jsxs("div",{className:"flex items-center pt-3",children:[e.jsxs("div",{className:"flex",children:[e.jsx(ma,{dataValue:a}),e.jsx(ua,{stateCatatans:C,user:s.user,updateJumlahCatatan:J,dataValue:a})]}),e.jsx(da,{updateStatusBerkas:q,dataValue:a})]})]}),e.jsx(_,{className:"hidden 2xl:table-cell text-center whitespace-normal",children:a.nama_instansi}),e.jsx(_,{className:"text-center",children:a.nama_sumber_dana}),e.jsx(_,{children:e.jsx(qe,{status:a.status_berka_id})}),e.jsx(_,{children:e.jsx("div",{className:"flex justify-center",children:e.jsx(ca,{openModalCrud:Y,openDialogDestroy:ve,openDialogDetail:ke,dataValue:a.id})})})]},o)):e.jsx(E,{children:e.jsx(_,{colSpan:7,className:"font-normal",children:"Tidak ada data. Silahkan klik tombol Tambah untuk menambah."})})})]}),e.jsxs("div",{className:"grid items-center auto-rows-min gap-4 md:grid-cols-2 py-4",children:[e.jsxs("div",{className:"text-foreground text-sm",children:[t?.meta.from," sampai ",t?.meta.to," dari total: ",t?.meta.total]}),e.jsx("div",{className:"flex flex-1 flex-row-reverse",children:e.jsx(oa,{links:t?.links,meta:t?.meta})})]})]})]})})]})};Ma.layout=s=>e.jsx(Pe,{children:s});export{Ma as default};
