import{r as l,u as oe,j as e,b as ie}from"./app-D9YqyUiN.js";import{a as le,b as ne,c as de,d as ce,e as L}from"./dialog-BSQhuetW.js";import{T as U,a as z,b as M,c as $}from"./tooltip-BWROTcVh.js";import{I as pe}from"./input-pt59Wb7N.js";import{B as x}from"./button-BF3neXv-.js";import{d as ue,b as fe,T as S,c as T,e as me,a as h}from"./table-B8r85oml.js";import{C as xe}from"./checkbox-B2IOCYug.js";import{S as he}from"./spinner-D1gatBJj.js";import{t as i}from"./index-CybXpV9o.js";import{I as je}from"./input-error-B-CT4lGR.js";import{c as y}from"./index-CBGkccfa.js";import{A as ge,a as be,b as ke,u as ye}from"./use-initials-DyZUi8UG.js";import{P as ve,T as Ne}from"./trash-DqkKJD2U.js";/* empty css            */import"./index-CcIjt9od.js";import"./createLucideIcon-BZVTE0F4.js";import"./index-CHnbSjmJ.js";import"./index-Lwtgv6vk.js";import"./Combination-8fwQo3cx.js";import"./index-Cs-_byS9.js";import"./index-e_Vwxz9Q.js";import"./index-CAp3R1RN.js";import"./index-D8E0EYm6.js";import"./index-C7wwikv8.js";import"./index-B0ADHmSK.js";import"./check-CbsmzRUm.js";import"./loader-circle-DLCECMmc.js";import"./index-DE4duBNV.js";function Ve({dialogOpen:B,user:j,updateJumlahCatatan:H,dataValue:g,stateCatatans:p}){const q=ye(),[b,n]=l.useState([]),[K,D]=l.useState(!1),[R,A]=l.useState(!1),v=l.useRef(null),[N,w]=l.useState("create"),[G,C]=l.useState(!1),[d,u]=l.useState([]),I=j.roleuser.slug==="admin"||j.roleuser.slug==="verifikator",{data:c,setData:f,post:Q,put:W,delete:X,processing:E,errors:Y,clearErrors:m}=oe({id:"",berka_id:0,catatan:""}),Z=l.useCallback(async()=>{D(!0);try{const a=await(await fetch(y.index(g).url)).json();n(a),D(!1)}catch(s){throw D(!1),s}},[]),F=s=>{n([...b,{id:s.id,berka_id:s.berka_id,catatan:s.catatan,created_at:s.created_at,foto:s.foto,name:s.name,is_okey:s.is_okey,user_id:s.user_id}]),A(!0)},O=s=>{n(a=>a.map(t=>t.id===s.id?{...t,catatan:s.catatan,created_at:s.created_at}:t))},J=s=>{w("edit"),f({id:s.id,berka_id:s.berka_id,catatan:s.catatan})},P=s=>{n(b.filter(a=>a.id!==s))},V=s=>{s.preventDefault();const a=d;if(d.length>0)ie.post(y.updateChecked(),{berka_id:g.id,items_data:a},{preserveScroll:!0,onSuccess:t=>{if(t.props.flash?.type==="success"){const r=t.props.newdata?.datas;i.success(t.props.flash?.message,{position:"top-center"}),n(r)}else t.props.flash?.type==="error"?i.error(t.props.flash?.message,{position:"top-center"}):i.info(t.props.flash?.message,{position:"top-center"});u([])}});else switch(N){case"edit":W(y.update(c.id).url,{preserveScroll:!0,onSuccess:t=>{t.props.flash?.type==="success"?(O(t.props.newdata?.datas),i.success(t.props.flash?.message,{position:"top-center"})):t.props.flash?.type==="error"?i.error(t.props.flash?.message,{position:"top-center"}):i.info(t.props.flash?.message,{position:"top-center"}),k()}});break;default:Q(y.store().url,{preserveScroll:!0,onSuccess:t=>{t.props.flash?.type==="success"?(F(t.props.newdata?.datas),H(t.props.newdata?.datas),i.success(t.props.flash?.message,{position:"top-center"})):t.props.flash?.type==="error"?i.error(t.props.flash?.message,{position:"top-center"}):i.info(t.props.flash?.message,{position:"top-center"}),k(),m()}});break}},_=s=>{X(y.destory(s).url,{preserveScroll:!0,onStart:()=>C(!0),onSuccess:a=>{a.props.flash?.type==="success"?(i.success(a.props.flash?.message,{position:"top-center"}),P(s),H(a.props.newdata?.datas)):a.props.flash?.type==="error"?i.error(a.props.flash?.message,{position:"top-center"}):i.info(a.props.flash?.message,{position:"top-center"}),k(),m()},onFinish:()=>C(!1),onError:()=>C(!1)})},ee=(s,a)=>{f({...c,id:"",catatan:""}),m();const t=d.find(r=>r.id===a);s?t?(u(r=>r.filter(o=>o.id!==a)),n(r=>r.map(o=>o.id===a?{...o,is_okey_new:s}:o))):(u(r=>[...r,{id:a,is_okey:s}]),n(r=>r.map(o=>o.id===a?{...o,is_okey_new:s}:o))):t?(u(r=>r.filter(o=>o.id!==a)),n(r=>r.map(o=>o.id===a?{...o,is_okey_new:s}:o))):(u(r=>[...r,{id:a,is_okey:s}]),n(r=>r.map(o=>o.id===a?{...o,is_okey_new:s}:o)))};function k(){d.length?(f({...c,id:"",catatan:""}),m(),w("create"),u([]),n(b.map(({is_okey_new:s,...a})=>a))):(f({...c,id:"",catatan:""}),m(),w("create"))}const se=({itemCatatan:s})=>{const a=s.user_id===j.id;return e.jsx(xe,{id:s.id,checked:s.is_okey_new===void 0?s.is_okey:s.is_okey_new,onCheckedChange:a?t=>ee(t,s.id):void 0,disabled:N==="edit"})},ae=({itemCatatan:s})=>{const a=s.user_id===j.id;return e.jsx(U,{children:e.jsxs(z,{children:[e.jsx(M,{asChild:!0,children:e.jsx(x,{type:"button",variant:"outline",size:"sm",className:"h-7 w-7 text-muted-foreground",onClick:()=>J(s),disabled:d.length>0||!a,children:e.jsx(ve,{})})}),e.jsx($,{children:"Edit"})]})})},te=({itemCatatan:s})=>{const a=s.user_id===j.id;return e.jsx(U,{children:e.jsxs(z,{children:[e.jsx(M,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"sm",className:"h-7 w-7 text-muted-foreground",type:"button",onClick:()=>_(s.id),disabled:G||N==="edit"||d.length>0||!a,children:e.jsx(Ne,{})})}),e.jsx($,{children:"Hapus"})]})})};l.useEffect(()=>(B?(Z(),f({...c,berka_id:g.id})):(m(),k(),w("create")),()=>{}),[B]),l.useEffect(()=>{if(p)switch(p.action){case"addcatatan":F(p);break;case"updatecatatan":O(p);break;case"destroycatatan":P(p.id);break;default:return()=>{}}else return()=>{};return()=>{}},[p]),l.useEffect(()=>{R&&re()},[R]);const re=()=>{v.current&&(v.current.scrollTop=v.current.scrollHeight),A(!1)};return e.jsxs(le,{className:"p-0 sm:max-w-3xl 2xl:max-w-4xl top-0 mt-6 translate-y-0",onInteractOutside:s=>{s.preventDefault()},children:[e.jsxs(ne,{className:"px-6 pt-4",children:[e.jsx(de,{className:"text-lg font-semibold text-foreground",children:"Daftar Catatan"}),e.jsx(ce,{})]}),e.jsxs("div",{className:"grid grid-cols-8 text-sm text-muted-foreground px-6",children:[e.jsx("div",{children:"Kegiatan"}),e.jsxs("div",{className:"col-span-7",children:[": ",g.kegiatan]}),e.jsx("div",{children:"No. Spm"}),e.jsxs("div",{className:"col-span-7",children:[": ",g.no_spm]})]}),e.jsx("div",{ref:v,className:"sm:max-h-80 2xl:max-h-120 overflow-y-auto mx-4 border rounded-md",children:e.jsxs(ue,{children:[e.jsx(fe,{children:e.jsxs(S,{children:[e.jsx(T,{className:"w-7"}),e.jsx(T,{children:"Catatan"}),e.jsx(T,{className:"w-40",children:"Verifikator"}),e.jsx(T,{className:"w-28 text-center",children:I&&"Pilih"})]})}),e.jsx(me,{children:K?e.jsx(S,{children:e.jsx(h,{colSpan:4,children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(he,{}),"Loading..."]})})}):b.length>0?b.map((s,a)=>e.jsxs(S,{children:[e.jsx(h,{children:e.jsx(se,{itemCatatan:s})}),e.jsxs(h,{children:[e.jsx("div",{className:`whitespace-normal ${s.id===c.id&&"font-medium"}`,children:s.catatan}),e.jsx("div",{className:"text-muted-foreground text-xs pt-1.5",children:s.created_at})]}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ge,{className:"h-9 w-9 overflow-hidden rounded-full",children:s.foto?e.jsx(be,{src:`/storage/foto/small/${s.foto}`,alt:s.name}):e.jsx(ke,{className:"rounded-lg bg-neutral-200 text-black dark:bg-neutral-700 dark:text-white",children:q(s.name)})}),e.jsx("div",{className:"text-sm font-medium text-foreground",children:s.name})]},a)}),e.jsx(h,{className:"text-center",children:I&&e.jsxs("div",{className:"flex gap-2.5 justify-center",children:[e.jsx(ae,{itemCatatan:s}),e.jsx(te,{itemCatatan:s})]})})]},a)):e.jsx(S,{children:e.jsx(h,{colSpan:4,children:"Tidak catatan."})})})]})}),I?e.jsx("form",{onSubmit:V,children:e.jsxs("div",{className:"border-t bg-muted dark:bg-background rounded-b-md px-4 py-4",children:[e.jsx("div",{className:"pb-2",children:e.jsx(je,{message:Y.catatan})}),e.jsxs("div",{className:"flex justify-between gap-2 flex-col-reverse sm:flex-row",children:[e.jsx(x,{type:"button",variant:"outline",onClick:k,tabIndex:4,children:"Reset"}),e.jsx(pe,{id:"catatan",name:"catatan",className:"bg-background",value:c.catatan||"",onChange:s=>f("catatan",s.target.value),placeholder:"Tulis catatan.",disabled:d.length>0,required:!0,tabIndex:1,autoFocus:!0}),e.jsxs("div",{className:"flex flex-col-reverse gap-2 sm:flex-row",children:[e.jsx(x,{variant:"default",type:"submit",tabIndex:2,disabled:E,children:d.length>0||N==="edit"?"Update":"Simpan"}),e.jsx(L,{asChild:!0,children:e.jsx(x,{variant:"outline",tabIndex:3,disabled:E,children:"Tutup"})})]})]})]})}):e.jsx("div",{className:"flex border-t bg-muted dark:bg-background rounded-b-md px-4 py-4",children:e.jsx("div",{className:"ml-auto",children:e.jsx(L,{asChild:!0,children:e.jsx(x,{variant:"outline",tabIndex:1,disabled:E,children:"Tutup"})})})})]})}export{Ve as default};
