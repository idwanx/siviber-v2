import{a as ue,r as l,b as xe,g as he,j as a,H as pe}from"./app-D9YqyUiN.js";import{B as Q}from"./button-BF3neXv-.js";import{d as je,b as ge,T as C,c as d,e as fe,a as o}from"./table-B8r85oml.js";import{S as be,A as ke}from"./app-layout-B1NlKUnO.js";import{B as ve}from"./berkas-sidebar-B6mWXEPZ.js";import{A as we}from"./app-sidebar-header-BiucIi7n.js";import{u as Se,l as I,R as Ne}from"./lodash-B5lp3EAI.js";import{b as _e}from"./index-CZ-fgGLA.js";import{I as De,a as ye,b as Ce}from"./input-group-Bih4IZS4.js";import{e as f,S as b,a as k,c as v,d as w,b as T,f as S}from"./select-CbpazApz.js";import{H as Ie}from"./heading-DY_MUNNC.js";import{D as B}from"./dialog-BSQhuetW.js";import Te from"./dialog-form-registrasi-CSVK3MEx.js";import Be from"./dialog-detail-berkas-CuOKDSJI.js";import Ve from"./dialog-destroy-yCiUIcky.js";import Fe from"./button-update-status-CoaKsg2p.js";import He from"./button-catatan-Bs7jBeNX.js";import{L as Me}from"./label-icon-status-BQrZ-ebG.js";import Pe from"./dropdown-action-OadRbYva.js";import{P as Re}from"./pagination-BuShHqcj.js";import Ae from"./button-history-BXfC_nuz.js";import{S as Ee}from"./separator-gdlo3o2e.js";import{S as Le}from"./search-BZrLu_oe.js";/* empty css            */import"./index-Lwtgv6vk.js";import"./use-initials-DyZUi8UG.js";import"./index-CHnbSjmJ.js";import"./Combination-8fwQo3cx.js";import"./index-Cs-_byS9.js";import"./dropdown-menu-D8EmfzUQ.js";import"./index-BsX_J3VV.js";import"./index-CAp3R1RN.js";import"./index-D8E0EYm6.js";import"./index-e_Vwxz9Q.js";import"./index-f_XI_Ssm.js";import"./index-B0ADHmSK.js";import"./index-C7wwikv8.js";import"./sheet-CSYlfnnR.js";import"./index-CcIjt9od.js";import"./createLucideIcon-BZVTE0F4.js";import"./index-BOOka7_X.js";import"./index-DE4duBNV.js";import"./tooltip-BWROTcVh.js";import"./check-CbsmzRUm.js";import"./chevrons-up-down-rG4PqzCt.js";import"./index-CybXpV9o.js";import"./loader-circle-DLCECMmc.js";import"./triangle-alert-CxhsfRk_.js";import"./circle-check-CLsa3Q69.js";import"./dialog-catatan-view-9iFRPril.js";import"./checkbox-B2IOCYug.js";import"./spinner-D1gatBJj.js";import"./index-CBGkccfa.js";import"./circle-slash-2-DadGKmBp.js";import"./chevron-right-D5jK32oY.js";import"./input-pt59Wb7N.js";import"./input-error-B-CT4lGR.js";import"./label-Bxuzgc-D.js";import"./dialog-konfirmasi-sp2d-BolagjFY.js";import"./dialog-catatan-DvfjCkEU.js";import"./trash-DqkKJD2U.js";import"./lembar-verifikasi-yGPsV4fI.js";import"./eye-CxEs2evP.js";import"./sheet-history-DBa9_yoD.js";import"./history-BZx6PRNI.js";const Ge=[{name:"15",value:"15"},{name:"30",value:"30"},{name:"60",value:"60"},{name:"100",value:"100"}];function Je({daftarberkas:i,tahun:X,menuOption:c,filtered:m,instansi:Y,jenisberkas:Z,sumberdana:O}){const{auth:t}=ue().props,[V,u]=l.useState(i.data),[F,N]=l.useState(!1),[U,H]=l.useState(!1),[ee,_]=l.useState("create"),[D,p]=l.useState(0),[M,P]=l.useState(!1),[ae,se]=l.useState(null),re=()=>t.user.roleuser.slug==="admin"||t.user.roleuser.slug==="verifikator"?"admin-verifikator":t.user.roleuser.instansi_id!==null?"instansi."+t.user.roleuser.instansi_id:void 0,[n,x]=l.useState({cari:m.cari||"",load:m.load||"15",instansi:m.instansi||"",jenisspm:m.jenisspm||"",sumberdana:m.sumberdana||""}),te=Se(n),ie=l.useCallback(I.debounce(e=>{xe.get(_e.main({tahun:X,statusberkas:c}),e,{preserveScroll:!0,preserveState:!1,replace:!0})},500),[]);l.useEffect(()=>{if(te){const e=Object.keys(I.pickBy(n)).length?I.pickBy(n):"";ie(e)}},[n]);function ne(e){x(s=>({...s,cari:e.target.value}))}function le(){x({load:"15",cari:"",instansi:"",jenisspm:"",sumberdana:""})}const R=e=>{const r=(()=>{switch(e.data.status_berka_id){case 1:return"registrasi";case 2:return"verifikasi";case 3:return"penolakan";case 4:return"sp2d";default:throw new Error("Status tidak valid, harap hubungi admin")}})()===c;u(r?j=>j.some(h=>h.id===e.berka_id)?j.map(h=>{const $=h.riwayats.find(g=>g.id===e.data.id);let y;if($)y=h.riwayats.filter(g=>g.id!==$.id);else{const g={berka_id:e.data.berka_id,id:e.data.id,status_berka_id:e.data.status_berka_id,user_id:e.data.user_id};y=[...h.riwayats,g]}return{...h,riwayats:y}}):[e.data,...j]:j=>j.filter(W=>W.id!==e.berka_id))},A=e=>{u(s=>s.map(r=>r.id===e.berka_id?{...r,jumlah_catatan:e.jumlah_catatan}:r))},E=e=>{const s={hari:e.hari,hari_ke:e.hari_ke,id:e.id,jam:e.jam,jumlah_catatan:e.jumlah_catatan,kegiatan:e.kegiatan,kode:e.kode,nama_instansi:e.nama_instansi,nama_jenis_berkas:e.nama_jenis_berkas,nama_sumber_dana:e.nama_sumber_dana,no_spm:e.no_spm,riwayats:e.riwayats,status_berka_id:e.status_berka_id,tgl_registrasi:e.tgl_registrasi,tgl_spm:e.tgl_spm};u(r=>[s,...r])},L=e=>{u(s=>s.map(r=>r.id===e.id?{...r,hari_ke:e.hari_ke,id:e.id,kegiatan:e.kegiatan,nama_jenis_berkas:e.nama_jenis_berkas,nama_sumber_dana:e.nama_sumber_dana,no_spm:e.no_spm,tgl_spm:e.tgl_spm}:r))},G=e=>{u(s=>s.filter(r=>r.id!==e))},J=(e,s)=>{switch(_(e),e){case"edit":p(s),N(!0);break;default:N(!0);break}},oe=e=>{p(e),H(!0)},de=e=>{p(e),P(!0)},K=e=>{N(e),e||(p(0),_("create"))},q=e=>{P(e)},z=e=>{H(e),e||(p(0),_("create"))};function ce(e,s){switch(s){case 1:return e===2?a.jsx(a.Fragment,{children:"(hari ini expired)"}):e>2?a.jsx(a.Fragment,{children:"(expired)"}):a.jsx(a.Fragment,{children:null});case 2:return e===2?a.jsx(a.Fragment,{children:"(hari ini expired)"}):e>2?a.jsx(a.Fragment,{children:"(expired)"}):a.jsx(a.Fragment,{children:null})}}he(`${re()}`,"StatusBerkasEvent",e=>{const s=e.newData.user_id===t.user.id;switch(e.newData.info){case"berkas":if(e.newData.action==="newBerkas")if(c==="registrasi"&&t.user.roleuser.slug==="admin"||t.user.roleuser.slug==="verifikator")E(e.newData.data);else return()=>e.newData.info;else if(e.newData.action==="updateBerkas")if(t.user.roleuser.slug!=="bendahara")L(e.newData);else return()=>e.newData.info;else if(e.newData.action==="destroyBerkas")if(t.user.roleuser.slug!=="bendahara")G(e.newData.id);else return()=>e.newData.info;else e.newData.action==="updateStatus"&&R(e.newData);break;case"catatan":if(s)return()=>s;A(e.newData),se(e.newData);break;default:return()=>s}});const me=[{title:"Berkas",href:"#"},{title:c,href:"#"}];return a.jsxs(a.Fragment,{children:[a.jsx(B,{open:F,onOpenChange:K,modal:!0,children:a.jsx(Te,{modalCrud:F,addNew:E,dataState:D,modeType:ee,closeModal:K,updateBerkas:L})}),a.jsx(B,{open:M,onOpenChange:q,modal:!0,children:a.jsx(Be,{isDialog:M,dataState:D,closeModal:q})}),a.jsx(B,{open:U,onOpenChange:z,modal:!0,children:a.jsx(Ve,{dataState:D,closeModal:z,destroyBerkas:G})}),a.jsx(pe,{title:"Berkas"}),a.jsx(ve,{}),a.jsx(be,{className:"py-1",children:a.jsxs("div",{className:"flex flex-1 flex-col space-y-2 pl-2 mt-(--header-height) h-[calc(100svh-var(--header-height))]!",children:[a.jsx(we,{breadcrumbs:me,trigger:!0}),a.jsxs("div",{className:"min-h-screen p-4 flex-1 overflow-hidden bg-background shadow-sm rounded-xl border border-sidebar-border/70 md:min-h-min dark:border-sidebar-border",children:[a.jsxs("div",{className:"flex flex-1",children:[a.jsx(Ie,{title:c.charAt(0).toUpperCase()+c.slice(1),description:"Kelola data berkas pada tabel dibawah ini."}),t.user.roleuser.slug==="bendahara"&&c==="registrasi"?a.jsx("div",{className:"ml-auto",children:a.jsx(Q,{onClick:()=>J("create"),tabIndex:1,children:"Registrasi"})}):""]}),a.jsx(Ee,{className:"mb-4"}),a.jsxs("div",{className:"flex items-center py-4 gap-2",children:[a.jsx("div",{children:a.jsxs(f,{name:"jenisspm",value:n.jenisspm,onValueChange:e=>x(s=>({...s,jenisspm:e})),children:[a.jsx(b,{tabIndex:2,className:"w-full",children:a.jsx(k,{placeholder:"Jenis SPM"})}),a.jsx(v,{children:a.jsxs(w,{children:[a.jsx(T,{children:"Jenis SPM"}),Z.map(e=>a.jsx(S,{value:e.slug,children:e.nama_jenis_berkas},e.slug))]})})]})}),a.jsx("div",{children:a.jsxs(f,{name:"sumberdana",value:n.sumberdana,onValueChange:e=>x(s=>({...s,sumberdana:e})),children:[a.jsx(b,{tabIndex:3,className:"w-full",children:a.jsx(k,{placeholder:"Sumber Dana"})}),a.jsx(v,{children:a.jsxs(w,{children:[a.jsx(T,{children:"Sumber Dana"}),O.map(e=>a.jsx(S,{value:e.slug,children:e.nama_sumber_dana},e.slug))]})})]})}),a.jsx("div",{children:a.jsxs(f,{name:"instansi",value:n.instansi,onValueChange:e=>x(s=>({...s,instansi:e})),children:[a.jsx(b,{tabIndex:4,className:"w-full",children:a.jsx(k,{placeholder:"Instansi"})}),a.jsx(v,{children:a.jsxs(w,{children:[a.jsx(T,{children:"Instansi"}),Y.map(e=>a.jsx(S,{value:e.slug,children:e.nama_instansi},e.slug))]})})]})}),a.jsx("div",{children:a.jsxs(De,{children:[a.jsx(ye,{id:"cari",name:"cari",value:n.cari,onChange:ne,tabIndex:5,placeholder:"Cari...",autoFocus:!0}),a.jsx(Ce,{children:a.jsx(Le,{})})]})}),a.jsx("div",{children:a.jsx(Q,{onClick:le,variant:"outline",size:"icon","aria-label":"Refresh",tabIndex:6,children:a.jsx(Ne,{})})}),a.jsx("div",{className:"ml-auto",children:a.jsx("div",{className:"flex gap-2",children:a.jsx("div",{children:a.jsxs(f,{name:"load",value:n.load===""?m.load:n.load,onValueChange:e=>x(s=>({...s,load:e})),children:[a.jsx(b,{tabIndex:7,className:"w-full",children:a.jsx(k,{placeholder:m.load})}),a.jsx(v,{children:a.jsx(w,{children:Ge.map((e,s)=>a.jsx(S,{value:e.value,children:e.name},s))})})]})})})})]}),a.jsxs(je,{children:[a.jsx(ge,{children:a.jsxs(C,{children:[a.jsx(d,{className:"w-12.5 text-center",children:"No"}),a.jsx(d,{className:"w-35",children:"Waktu Registrasi"}),a.jsx(d,{className:"w-30 text-center",children:"Jenis Berkas"}),a.jsx(d,{children:"Kegiatan"}),a.jsx(d,{className:"w-52 2xl:w-80 hidden 2xl:table-cell text-center",children:"Instansi"}),a.jsx(d,{className:"w-36 text-center",children:"Sumber Dana"}),a.jsx(d,{className:"w-28 text-center",children:"Status"}),a.jsx(d,{className:"w-20 text-center",children:"Pilihan"})]})}),a.jsx(fe,{children:V.length>0?V.map((e,s)=>a.jsxs(C,{children:[a.jsx(o,{className:"text-center",children:i?.meta.from?i?.meta.from+s:s+1}),a.jsxs(o,{className:"text-center",children:[e.hari,a.jsx("br",{}),e.tgl_registrasi,a.jsx("br",{}),e.jam]}),a.jsx(o,{className:"text-center",children:e.nama_jenis_berkas}),a.jsxs(o,{className:"whitespace-normal",children:[a.jsx("div",{className:"2xl:hidden md:w-100 text-muted-foreground mb-0.5 md:truncate",children:e.nama_instansi}),a.jsx("p",{className:"text-sm/6 font-normal",children:e.kegiatan}),a.jsxs("div",{className:"text-muted-foreground sm:grid sm:grid-cols-6",children:[a.jsx("div",{children:"No. Spm"}),a.jsxs("div",{className:"sm:col-span-5",children:[": ",e.no_spm]})]}),a.jsxs("div",{className:"text-muted-foreground sm:grid sm:grid-cols-6",children:[a.jsx("div",{children:"Tgl. Spm"}),a.jsxs("span",{className:"sm:col-span-2",children:[":  ",e.tgl_spm]}),a.jsx("span",{className:"sm:col-span-2 text-destructive",children:ce(e.hari_ke,e.status_berka_id)})]}),a.jsxs("div",{className:"flex items-center pt-3",children:[a.jsxs("div",{className:"flex",children:[a.jsx(Ae,{dataValue:e}),a.jsx(He,{stateCatatans:ae,user:t.user,updateJumlahCatatan:A,dataValue:e})]}),a.jsx(Fe,{updateStatusBerkas:R,dataValue:e})]})]}),a.jsx(o,{className:"hidden 2xl:table-cell text-center whitespace-normal",children:e.nama_instansi}),a.jsx(o,{className:"text-center",children:e.nama_sumber_dana}),a.jsx(o,{children:a.jsx(Me,{status:e.status_berka_id})}),a.jsx(o,{children:a.jsx("div",{className:"flex justify-center",children:a.jsx(Pe,{user:t.user,openModalCrud:J,openDialogDestroy:oe,openDialogDetail:de,dataValue:e.id})})})]},s)):a.jsx(C,{children:a.jsx(o,{colSpan:7,className:"font-normal",children:"Tidak ada data. Silahkan klik tombol Tambah untuk menambah."})})})]}),a.jsxs("div",{className:"grid items-center auto-rows-min gap-4 md:grid-cols-2 py-4",children:[a.jsxs("div",{className:"text-foreground text-sm",children:[i?.meta.from," sampai ",i?.meta.to," dari total: ",i?.meta.total]}),a.jsx("div",{className:"flex flex-1 flex-row-reverse",children:a.jsx(Re,{links:i.links,meta:i.meta})})]})]})]})})]})}Je.layout=i=>a.jsx(ke,{children:i});export{Je as default};
