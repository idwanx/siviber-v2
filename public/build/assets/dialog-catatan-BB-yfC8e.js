import{r as l,b as oe,j as e,a as ie}from"./app-D-Kk4Z_u.js";import{a as le,b as ne,c as de,d as ce,e as L}from"./dialog-Cy70B81N.js";import{b as U,c as z,T as M,a as $}from"./tooltip-BYHORf5t.js";import{I as pe}from"./input-De8pTDR_.js";import{B as m}from"./button-BzZXSjW_.js";import{d as ue,b as fe,T as S,c as T,e as xe,a as h}from"./table-BrHwMfcs.js";import{C as me}from"./checkbox-GVNbUYHC.js";import{S as he}from"./spinner-AmYUnR1W.js";import{t as i}from"./index-CDNVIVK-.js";import{I as je}from"./input-error-B5frtn6C.js";import{c as v}from"./index-yNKx5cU1.js";import{A as ge,a as be,b as ye,u as ve}from"./use-initials-BmR7wb_L.js";import{P as ke,T as Ne}from"./trash-eqfO9T_P.js";/* empty css            */import"./index-DcYXrFNC.js";import"./createLucideIcon-CXiQxMFo.js";import"./index-CYbHFI1W.js";import"./index-ZFGrDKp8.js";import"./index-CPfAG2wl.js";import"./index-CzqVYzBW.js";import"./index-BUHGMr7x.js";import"./index-Br19meYy.js";import"./index-DBHM6nos.js";import"./check-DH75-WWk.js";import"./loader-circle-Cbgr5Prx.js";import"./index-DW9AIAM8.js";function Ze({dialogOpen:B,user:j,updateJumlahCatatan:H,dataValue:g,stateCatatans:p}){const q=ve(),[b,n]=l.useState([]),[K,D]=l.useState(!1),[R,A]=l.useState(!1),k=l.useRef(null),[N,w]=l.useState("create"),[G,C]=l.useState(!1),[d,u]=l.useState([]),I=j.roleuser.slug==="admin"||j.roleuser.slug==="verifikator",{data:c,setData:f,post:Q,put:W,delete:X,processing:E,errors:Y,clearErrors:x}=oe({id:"",berka_id:0,catatan:""}),Z=l.useCallback(async()=>{D(!0);try{const a=await(await fetch(v.index(g).url)).json();n(a),D(!1)}catch(s){throw D(!1),s}},[]),F=s=>{n([...b,{id:s.id,berka_id:s.berka_id,catatan:s.catatan,created_at:s.created_at,foto:s.foto,name:s.name,is_okey:s.is_okey,user_id:s.user_id}]),A(!0)},O=s=>{n(a=>a.map(t=>t.id===s.id?{...t,catatan:s.catatan,created_at:s.created_at}:t))},J=s=>{w("edit"),f({id:s.id,berka_id:s.berka_id,catatan:s.catatan})},P=s=>{n(b.filter(a=>a.id!==s))},V=s=>{s.preventDefault();const a=d;if(d.length>0)ie.post(v.updateChecked(),{berka_id:g.id,items_data:a},{preserveScroll:!0,onSuccess:t=>{if(t.props.flash?.type==="success"){const r=t.props.newdata?.datas;i.success(t.props.flash?.message,{position:"top-center"}),n(r)}else t.props.flash?.type==="error"?i.error(t.props.flash?.message,{position:"top-center"}):i.info(t.props.flash?.message,{position:"top-center"});u([])}});else switch(N){case"edit":W(v.update(c.id).url,{preserveScroll:!0,onSuccess:t=>{t.props.flash?.type==="success"?(O(t.props.newdata?.datas),i.success(t.props.flash?.message,{position:"top-center"})):t.props.flash?.type==="error"?i.error(t.props.flash?.message,{position:"top-center"}):i.info(t.props.flash?.message,{position:"top-center"}),y()}});break;default:Q(v.store().url,{preserveScroll:!0,onSuccess:t=>{t.props.flash?.type==="success"?(F(t.props.newdata?.datas),H(t.props.newdata?.datas),i.success(t.props.flash?.message,{position:"top-center"})):t.props.flash?.type==="error"?i.error(t.props.flash?.message,{position:"top-center"}):i.info(t.props.flash?.message,{position:"top-center"}),y(),x()}});break}},_=s=>{X(v.destory(s).url,{preserveScroll:!0,onStart:()=>C(!0),onSuccess:a=>{a.props.flash?.type==="success"?(i.success(a.props.flash?.message,{position:"top-center"}),P(s),H(a.props.newdata?.datas)):a.props.flash?.type==="error"?i.error(a.props.flash?.message,{position:"top-center"}):i.info(a.props.flash?.message,{position:"top-center"}),y(),x()},onFinish:()=>C(!1),onError:()=>C(!1)})},ee=(s,a)=>{f({...c,id:"",catatan:""}),x();const t=d.find(r=>r.id===a);s?t?(u(r=>r.filter(o=>o.id!==a)),n(r=>r.map(o=>o.id===a?{...o,is_okey_new:s}:o))):(u(r=>[...r,{id:a,is_okey:s}]),n(r=>r.map(o=>o.id===a?{...o,is_okey_new:s}:o))):t?(u(r=>r.filter(o=>o.id!==a)),n(r=>r.map(o=>o.id===a?{...o,is_okey_new:s}:o))):(u(r=>[...r,{id:a,is_okey:s}]),n(r=>r.map(o=>o.id===a?{...o,is_okey_new:s}:o)))};function y(){d.length?(f({...c,id:"",catatan:""}),x(),w("create"),u([]),n(b.map(({is_okey_new:s,...a})=>a))):(f({...c,id:"",catatan:""}),x(),w("create"))}const se=({itemCatatan:s})=>{const a=s.user_id===j.id;return e.jsx(me,{id:s.id,checked:s.is_okey_new===void 0?s.is_okey:s.is_okey_new,onCheckedChange:a?t=>ee(t,s.id):void 0,disabled:N==="edit"})},ae=({itemCatatan:s})=>{const a=s.user_id===j.id;return e.jsx(U,{children:e.jsxs(z,{children:[e.jsx(M,{asChild:!0,children:e.jsx(m,{type:"button",variant:"outline",size:"sm",className:"h-7 w-7 text-muted-foreground",onClick:()=>J(s),disabled:d.length>0||!a,children:e.jsx(ke,{})})}),e.jsx($,{children:"Edit"})]})})},te=({itemCatatan:s})=>{const a=s.user_id===j.id;return e.jsx(U,{children:e.jsxs(z,{children:[e.jsx(M,{asChild:!0,children:e.jsx(m,{variant:"outline",size:"sm",className:"h-7 w-7 text-muted-foreground",type:"button",onClick:()=>_(s.id),disabled:G||N==="edit"||d.length>0||!a,children:e.jsx(Ne,{})})}),e.jsx($,{children:"Hapus"})]})})};l.useEffect(()=>(B?(Z(),f({...c,berka_id:g.id})):(x(),y(),w("create")),()=>{}),[B]),l.useEffect(()=>{if(p)switch(p.action){case"addcatatan":F(p);break;case"updatecatatan":O(p);break;case"destroycatatan":P(p.id);break;default:return()=>{}}else return()=>{};return()=>{}},[p]),l.useEffect(()=>{R&&re()},[R]);const re=()=>{k.current&&(k.current.scrollTop=k.current.scrollHeight),A(!1)};return e.jsxs(le,{className:"p-0 sm:max-w-3xl 2xl:max-w-4xl top-0 mt-6 translate-y-0",onInteractOutside:s=>{s.preventDefault()},children:[e.jsxs(ne,{className:"px-6 pt-4",children:[e.jsx(de,{className:"text-lg font-semibold text-foreground",children:"Daftar Catatan"}),e.jsx(ce,{})]}),e.jsxs("div",{className:"grid grid-cols-8 text-sm text-muted-foreground px-6",children:[e.jsx("div",{children:"Kegiatan"}),e.jsxs("div",{className:"col-span-7",children:[": ",g.kegiatan]}),e.jsx("div",{children:"No. Spm"}),e.jsxs("div",{className:"col-span-7",children:[": ",g.no_spm]})]}),e.jsx("div",{ref:k,className:"xl:max-h-120 max-h-80 overflow-y-auto mx-4 border rounded-md",children:e.jsxs(ue,{children:[e.jsx(fe,{children:e.jsxs(S,{children:[e.jsx(T,{className:"w-7"}),e.jsx(T,{children:"Catatan"}),e.jsx(T,{className:"w-40",children:"Verifikator"}),e.jsx(T,{className:"w-28 text-center",children:I&&"Pilih"})]})}),e.jsx(xe,{children:K?e.jsx(S,{children:e.jsx(h,{colSpan:4,children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(he,{}),"Loading..."]})})}):b.length>0?b.map((s,a)=>e.jsxs(S,{children:[e.jsx(h,{children:e.jsx(se,{itemCatatan:s})}),e.jsxs(h,{children:[e.jsx("div",{className:`whitespace-normal ${s.id===c.id&&"font-medium"}`,children:s.catatan}),e.jsx("div",{className:"text-muted-foreground text-xs pt-1.5",children:s.created_at})]}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ge,{className:"h-9 w-9 overflow-hidden rounded-full",children:s.foto?e.jsx(be,{src:`/storage/${s.foto}`,alt:s.name}):e.jsx(ye,{className:"rounded-lg bg-neutral-200 text-black dark:bg-neutral-700 dark:text-white",children:q(s.name)})}),e.jsx("div",{className:"text-sm font-medium text-foreground",children:s.name})]},a)}),e.jsx(h,{className:"text-center",children:I&&e.jsxs("div",{className:"flex gap-2.5 justify-center",children:[e.jsx(ae,{itemCatatan:s}),e.jsx(te,{itemCatatan:s})]})})]},a)):e.jsx(S,{children:e.jsx(h,{colSpan:4,children:"Tidak catatan."})})})]})}),I?e.jsx("form",{onSubmit:V,children:e.jsxs("div",{className:"border-t bg-muted rounded-b-md px-4 py-4",children:[e.jsx("div",{className:"pb-2",children:e.jsx(je,{message:Y.catatan})}),e.jsxs("div",{className:"flex justify-between gap-2 flex-col-reverse sm:flex-row",children:[e.jsx(m,{type:"button",variant:"outline",onClick:y,tabIndex:4,children:"Reset"}),e.jsx(pe,{id:"catatan",name:"catatan",className:"bg-background",tabIndex:1,value:c.catatan||"",onChange:s=>f("catatan",s.target.value),required:!0,autoFocus:!0,placeholder:"Tulis catatan.",disabled:d.length>0}),e.jsxs("div",{className:"flex flex-col-reverse gap-2 sm:flex-row",children:[e.jsx(m,{variant:"default",type:"submit",tabIndex:2,disabled:E,children:d.length>0||N==="edit"?"Update":"Simpan"}),e.jsx(L,{asChild:!0,children:e.jsx(m,{variant:"outline",tabIndex:3,disabled:E,children:"Tutup"})})]})]})]})}):e.jsx("div",{className:"flex border-t bg-muted rounded-b-md px-4 py-4",children:e.jsx("div",{className:"ml-auto",children:e.jsx(L,{asChild:!0,children:e.jsx(m,{variant:"outline",tabIndex:3,disabled:E,children:"Tutup"})})})})]})}export{Ze as default};
