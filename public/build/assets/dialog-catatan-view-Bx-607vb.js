import{r,j as e}from"./app-VO-bcIz4.js";import{a as T,b as w,c as D,d as _,e as C}from"./dialog-Dhqo9ETF.js";import{B as S}from"./button-BMb6Uz6j.js";import{T as I,a as B,b as d,c as x,d as E,e as i}from"./table-BCVfAeVy.js";import{C as H}from"./checkbox-CyKVGg4H.js";import{S as A}from"./spinner-D9yRjejz.js";import{c as R}from"./index-CBGkccfa.js";import{A as F,a as L,b as U,u as K}from"./use-initials-CRLJjTFo.js";/* empty css            */import"./index-Blrox13C.js";import"./createLucideIcon-Dz7_Xvh9.js";import"./index-CDMvbf3G.js";import"./index-B6x3NAUe.js";import"./index-BkJMQPGk.js";import"./index-w8ngPbkk.js";import"./Combination-BvqSQpzn.js";import"./index-d4thmrYG.js";import"./index-sRr3mOjL.js";import"./index-D_kf2R_u.js";import"./index-DgtUhx4d.js";import"./check-CcTMWVYy.js";import"./loader-circle-B7vA0rcg.js";import"./index-DE4duBNV.js";function le({dialogOpen:f,dataValue:s}){const u=K(),[c,n]=r.useState([]),[j,m]=r.useState(!1),[p,h]=r.useState(!1),l=r.useRef(null),b=r.useCallback(async a=>{m(!0);try{const o=await(await fetch(R.index(a).url)).json();n(o),m(!1)}catch(t){throw m(!1),t}},[]),g=({itemCatatan:a})=>e.jsx(H,{id:a.id,checked:a.is_okey_new===void 0?a.is_okey:a.is_okey_new,onCheckedChange:void 0}),k=a=>{n([...c,{id:a.id,berka_id:a.berka_id,catatan:a.catatan,created_at:a.created_at,foto:a.foto,name:a.name,is_okey:a.is_okey,user_id:a.user_id}]),h(!0)},N=a=>{n(t=>t.map(o=>o.id===a.id?{...o,catatan:a.catatan,created_at:a.created_at}:o))},v=a=>{n(c.filter(t=>t.id!==a))};r.useEffect(()=>(f&&b(s.berka_id),()=>{}),[f]),r.useEffect(()=>{if(s)switch(s.action){case"addcatatan":k(s);break;case"updatecatatan":N(s);break;case"destroycatatan":v(s.id);break;default:return()=>{}}else return()=>{};return()=>{}},[s]),r.useEffect(()=>{p&&y()},[p]);const y=()=>{l.current&&(l.current.scrollTop=l.current.scrollHeight),h(!1)};return e.jsx(e.Fragment,{children:e.jsxs(T,{className:"p-0 sm:max-w-3xl 2xl:max-w-4xl top-0 mt-6 translate-y-0",onInteractOutside:a=>{a.preventDefault()},children:[e.jsxs(w,{className:"px-6 pt-4",children:[e.jsx(D,{className:"text-lg font-semibold text-foreground",children:"Daftar Catatan"}),e.jsxs(_,{children:["Kegiatan:"," ",s?.kegiatan,e.jsx("br",{}),"No. SPM:"," ",s?.no_spm]})]}),e.jsx("div",{ref:l,className:"xl:max-h-120 max-h-80 overflow-y-auto mx-4 border rounded-md",children:e.jsxs(I,{children:[e.jsx(B,{children:e.jsxs(d,{children:[e.jsx(x,{className:"w-7"}),e.jsx(x,{children:"Catatan"}),e.jsx(x,{className:"w-64",children:"Verifikator"})]})}),e.jsx(E,{children:j?e.jsx(d,{children:e.jsx(i,{colSpan:4,children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(A,{}),"Loading..."]})})}):c.length>0?c.map((a,t)=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsx(g,{itemCatatan:a})}),e.jsx(i,{className:"whitespace-normal",children:a.catatan}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(F,{className:"h-9 w-9 overflow-hidden rounded-full",children:a.foto?e.jsx(L,{src:`/storage/foto/small/${a.foto}`,alt:a.name}):e.jsx(U,{className:"rounded-lg bg-neutral-200 text-black dark:bg-neutral-700 dark:text-white",children:u(a.name)})}),e.jsx("div",{className:"text-sm font-medium text-foreground",children:a.name})]},t)})]},t)):e.jsx(d,{children:e.jsx(i,{colSpan:3,children:"Tidak catatan."})})})]})}),e.jsx("div",{className:"flex border-t bg-muted dark:bg-background rounded-b-md px-4 py-4",children:e.jsx("div",{className:"ml-auto",children:e.jsx(C,{asChild:!0,children:e.jsx(S,{variant:"outline",tabIndex:1,autoFocus:!0,children:"Tutup"})})})})]})})}export{le as default};
